<html>
<head>
<title>Analyzing the Mood of Chat Messages with Google Cloudâ€™s Natural Language API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨è°·æ­Œäº‘çš„è‡ªç„¶è¯­è¨€APIåˆ†æèŠå¤©ä¿¡æ¯çš„æƒ…ç»ª</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://pub.towardsai.net/analyzing-the-mood-of-chat-messages-with-google-cloud-nlps-api-a8f5d6c6de76?source=collection_archive---------1-----------------------#2019-08-02">https://pub.towardsai.net/analyzing-the-mood-of-chat-messages-with-google-cloud-nlps-api-a8f5d6c6de76?source=collection_archive---------1-----------------------#2019-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a48f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">ä½¿ç”¨è°·æ­Œäº‘çš„æœºå™¨å­¦ä¹ ä½œä¸ºæœåŠ¡| <a class="ae ep" href="https://towardsai.net" rel="noopener ugc nofollow" target="_blank">é¢å‘AI </a></h2><div class=""/><p id="7d06" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">åœ¨ç±»ä¼¼è°·æ­Œäº‘çš„è‡ªç„¶è¯­è¨€APIè¿™æ ·çš„NLPæœåŠ¡çš„å¸®åŠ©ä¸‹ï¼Œåˆ†æä¸€æ®µæ–‡å­—çš„æƒ…ç»ªæ˜¯å¯èƒ½çš„ã€‚è°·æ­Œç§°è¿™é¡¹åŠŸèƒ½ä¸ºâ€œæƒ…æ„Ÿåˆ†æâ€ã€‚è®©æˆ‘ä»¬æ¥æ¢ç´¢è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒç”¨äºæ‚¨çš„èŠå¤©æœºå™¨äººæˆ–CRMã€‚</p><p id="8df5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹<a class="ae ku" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">è¯•ç”¨å·¥å…·</a>ã€‚æ‚¨å¯ä»¥åœ¨æ–‡æœ¬å­—æ®µä¸­è¾“å…¥éšæœºæ¶ˆæ¯ï¼Œç„¶åå•å‡»â€œåˆ†æâ€ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘è¾“å…¥äº†ä¿¡æ¯<em class="kv">â€œæˆ‘å¾ˆé«˜å…´æ…•å°¼é»‘è¿™é‡Œé˜³å…‰æ˜åªšï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼Šè¨å°”æ²³æ¸¸æ³³ã€‚â€</em>ã€‚</p><p id="87eb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œè¯¥æœåŠ¡æ£€æµ‹åˆ°äº†æ¶ˆæ¯ä¸­çš„å„ç§å†…å®¹ï¼Œä¾‹å¦‚ï¼Œåƒæ…•å°¼é»‘å¹¿åœºè¿™æ ·çš„å®ä½“ã€‚ä½†æ˜¯æˆ‘ä»¬å¯¹æƒ…æ„Ÿåˆ†ææ„Ÿå…´è¶£ï¼Œæ‰€ä»¥è¯·é€‰æ‹©â€œæƒ…æ„Ÿâ€é€‰é¡¹å¡ã€‚</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kw"><img src="../Images/ea312fde8557a080c0c271d9109d2916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBAxWqU_VULEKLqnIdB5Sg.png"/></div></div></figure><p id="bd91" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æƒ…æ„Ÿåˆ†æçš„ç»“æœæ˜¾ç¤ºæˆ‘æä¾›çš„æ–‡æœ¬çš„å¾—åˆ†ä¸º0.8ï¼Œå¹…åº¦ä¸º0.8ã€‚æ­£å¦‚ä½ åœ¨é…è‰²æ–¹æ¡ˆä¸­çœ‹åˆ°çš„ï¼Œä»‹äº0.25å’Œ1.0ä¹‹é—´çš„åˆ†æ•°ä»£è¡¨ç§¯ææƒ…ç»ªï¼Œä»‹äº-0.25å’Œ0.25ä¹‹é—´çš„åˆ†æ•°ä»£è¡¨ä¸­æ€§æƒ…ç»ªï¼Œä»‹äº-0.25å’Œ-1.0ä¹‹é—´çš„åˆ†æ•°ä»£è¡¨æ¶ˆææƒ…ç»ªã€‚é‡çº§å‘Šè¯‰ä½ æ£€æµ‹åˆ°çš„æƒ…ç»ªæœ‰å¤šå¼ºçƒˆã€‚è¯¥å€¼å¯ä»¥ä»0.0åˆ°æ— ç©·å¤§ã€‚</p><p id="8d8c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ä»¤äººå°è±¡æ·±åˆ»ï¼Œä¸æ˜¯å—ï¼Ÿé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å‘¢ï¼Ÿåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ­£åœ¨åˆ†ææ¥è‡ªWhatsAppç”¨æˆ·çš„èŠå¤©ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨é€šè¿‡WhatsApp Business APIæä¾›å®¢æˆ·æœåŠ¡ï¼Œå¹¶æƒ³çŸ¥é“å®¢æˆ·çš„å¿ƒæƒ…å¦‚ä½•ï¼Œè¿™å°±å¾ˆæœ‰ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¦‚ä½•åœ¨<a class="ae ku" href="https://www.messengerpeople.com" rel="noopener ugc nofollow" target="_blank"> MessengerPeople </a>ä½¿ç”¨å®ƒ:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi li"><img src="../Images/254df9b7439ae1ca428b1bc57bdf3b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*_7sO4swqnoPkJk9kqpjgvw.png"/></div></figure><p id="84b5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ‰€ä»¥ï¼Œå¦‚æœä½ ç°åœ¨å¾ˆæ¿€åŠ¨ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•å®ç°è¿™ä¸ªç‰¹æ€§ã€‚</p><h1 id="15c2" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">å…ˆå†³æ¡ä»¶</h1><p id="30da" class="pw-post-body-paragraph jw jx iq jy b jz mh kb kc kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ij bi translated">å½“ç„¶ï¼Œä½ éœ€è¦ä¸€ä¸ªè°·æ­Œäº‘è´¦æˆ·æ¥ä½¿ç”¨è¿™ä¸ªAPIã€‚å¦‚æœä½ å·²ç»æœ‰äº†ï¼Œä½ å¯ä»¥ç›´æ¥è·³åˆ°GCP NLPæ–‡æ¡£çš„<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart" rel="noopener ugc nofollow" target="_blank">å¿«é€Ÿå…¥é—¨</a>éƒ¨åˆ†ã€‚NLP APIçš„åŸºç¡€åœ¨è¿™é‡Œè§£é‡Š<a class="ae ku" href="https://cloud.google.com/natural-language/docs/basics" rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><p id="9d44" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç°åœ¨æ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªGCPæ§åˆ¶å°é¡¹ç›®ï¼Œå¹¶ä¸ºæ‚¨çš„<a class="ae ku" href="https://console.cloud.google.com/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank">æœåŠ¡å¸æˆ·</a>æ·»åŠ ä¸€ä¸ªå¯†é’¥ã€‚ç„¶åï¼Œæ‚¨å¿…é¡»å°†è¯¥é”®ä½œä¸ºJSONæ–‡ä»¶å­˜å‚¨åœ¨æ‚¨çš„ç³»ç»Ÿä¸­ï¼Œå¹¶å°†è¯¥é”®çš„è·¯å¾„ä½œä¸ºç¯å¢ƒå˜é‡æ·»åŠ åˆ°æ‚¨çš„ç³»ç»Ÿä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="2f44" class="mr lk iq mn b gy ms mt l mu mv">export GOOGLE_APPLICATION_CREDENTIALS="/home/user/Downloads/service-account-file.json"</span></pre><p id="ae11" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç°åœ¨ï¼Œæ‚¨åŸºæœ¬ä¸Šå·²ç»å‡†å¤‡å¥½è°ƒç”¨NLP APIäº†ã€‚å–œæ¬¢çš„è¯å¯ä»¥å…ˆè¯•è¯•<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart#quickstart-analyze-entities-cli" rel="noopener ugc nofollow" target="_blank">å‘½ä»¤è¡Œç‰ˆæœ¬</a>ã€‚ç„¶è€Œï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart-client-libraries#client-libraries-install-php" rel="noopener ugc nofollow" target="_blank"> PHPå®¢æˆ·ç«¯åº“</a>ã€‚</p><h1 id="24e5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">çœŸå®ä¸–ç•Œçš„ç”¨ä¾‹</h1><p id="0d1d" class="pw-post-body-paragraph jw jx iq jy b jz mh kb kc kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ij bi translated">å¥½äº†ï¼Œå¼€å§‹ç¼–ç å§ï¼è¯·æ³¨æ„ï¼Œæˆ‘åªç»™ä½ ä¸¾å‡ ä¸ªç®€å•çš„ä¾‹å­ã€‚è¿™ä¸æ˜¯ç”Ÿäº§å°±ç»ªçš„ä»£ç ï¼</p><p id="05cc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">é¦–å…ˆï¼Œåœ¨é¡¹ç›®ä¸­å®‰è£…PHPå®¢æˆ·ç«¯åº“:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="aa6c" class="mr lk iq mn b gy ms mt l mu mv">composer require google/cloud</span></pre><p id="3c19" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç„¶ååŠ è½½åº“:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="1b6b" class="mr lk iq mn b gy ms mt l mu mv">use Google\Cloud\Language\LanguageClient;</span></pre><p id="3ad0" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç°åœ¨ï¼Œæˆ‘å¯ä»¥åœ¨è‡ªå·±çš„å‡½æ•°ä¸­ä½¿ç”¨å®¢æˆ·ç«¯çš„æ–¹æ³•:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="fcf4" class="mr lk iq mn b gy ms mt l mu mv">public function sendToGoogleCloud($text)<br/>{<br/>    // Your Google Cloud Platform project ID<br/>    $projectId = 'xxxxxxxxx';<br/>    $keyfilepath = "/var/www/xxxxxxxx.json";<br/><br/>    // Instantiates a client<br/>    $language = new LanguageClient([<br/>        'projectId' =&gt; $projectId,<br/>        'keyFilePath' =&gt; $keyfilepath<br/>    ]);<br/><br/>    // Detects the sentiment of the text<br/>    $annotation = $language-&gt;analyzeSentiment($text);<br/>    $sentiment = $annotation-&gt;sentiment();<br/>    $language = $annotation-&gt;language();<br/><br/>    $returnarray = [];<br/>    array_push($returnarray, $sentiment);<br/>    array_push($returnarray, $language);<br/><br/>    return $returnarray;<br/><br/>}</span></pre><p id="149a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘é‡åˆ°äº†ç¯å¢ƒå˜é‡çš„<a class="ae ku" href="https://stackoverflow.com/questions/52776236/where-do-i-put-my-api-key-in-google-cloud-php-language-client" rel="noopener ugc nofollow" target="_blank">é—®é¢˜ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•æ¥æä¾›å¯†é’¥ä½œä¸ºå‚æ•°ã€‚æƒ…ç»ªåˆ†æçš„å“åº”å¦‚ä¸‹æ‰€ç¤º:</a></p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="fd3e" class="mr lk iq mn b gy ms mt l mu mv">{<br/>"documentSentiment": {<br/>    "magnitude": 0.8,<br/>    "score": 0.8<br/>  },<br/>  "language": "en",<br/>  "sentences": [<br/>    {<br/>        "sentiment": {<br/>        "magnitude": 0.8,<br/>        "score": 0.8<br/>      },<br/>      "text": {<br/>        "beginOffset": 0,<br/>        "content": "I am so happy that the sun is shining here in Munich and we can swim in the Isar."<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="9bce" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒNLP APIç»™ä½ ä¸€ä¸ªåˆ†æ•°ï¼Œä¸€ä¸ªé‡çº§ï¼Œä»¥åŠæ£€æµ‹åˆ°çš„æ–‡æœ¬è¯­è¨€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¯­è¨€ã€‚</p><p id="69b2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">é‚£ä¹ˆæˆ‘ä»¬èƒ½ç”¨è¿™äº›ä¿¡æ¯åšä»€ä¹ˆå‘¢ï¼Ÿå—¯ï¼Œæ ¹æ®æ£€æµ‹åˆ°çš„æƒ…ç»ªï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­è®¾ç½®æ ‡ç­¾ï¼Œæ ¹æ®æƒ…ç»ª(å’Œè¯­è¨€)åšå‡ºç›¸åº”çš„ååº”ï¼Œæˆ–è€…åœ¨ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¸­è®¾ç½®ä¸€äº›å±æ€§ã€‚</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="2fdb" class="mr lk iq mn b gy ms mt l mu mv">if ($sentiment_score &gt; 0.25) {<br/>    $sentiment = 'positive';<br/>    $addlabel = [3345];<br/>    $removelabel = [3344, 3346];<br/>} elseif (($sentiment_score &gt;= -0.25) &amp;&amp; ($sentiment_score &lt;= 0.25)) {<br/>    $sentiment = 'neutral';<br/>    $addlabel = [3346];<br/>    $removelabel = [3344, 3345];<br/>} elseif ($sentiment_score &lt; -0.25) {<br/>    $sentiment = 'negative';<br/>    $addlabel = [3344];<br/>    $removelabel = [3345, 3346];<br/>} else {<br/>    $sentiment = 'neutral';<br/>    $addlabel = [3346];<br/>    $removelabel = [3344, 3345];<br/>}<br/><br/><br/>$customfields = [<br/>    'customfields' =&gt; [<br/>        'sentiment_score' =&gt; $sentiment_score,<br/>        'sentiment_magnitude' =&gt; $sentiment_magnitude,<br/>        'sentiment' =&gt; $sentiment,<br/>        'language' =&gt; $sentiment_language<br/>    ],<br/>    'addlabel' =&gt; $addlabel,<br/>    'removelabel' =&gt; $removelabel<br/>];</span></pre><p id="9943" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç»“æœçœ‹èµ·æ¥åƒè¿™æ ·:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/077e71b99f7f6ada3ec367b865053867.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*ypKQJYT-gbRw3-50pnqpRA.png"/></div></figure><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/803ce0424facad49cf959b416c2440a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*bdBny7aZx9dzu-Tj5SPwrg.png"/></div></figure><p id="60bb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æˆ‘è®¾ç½®äº†æ ‡ç­¾â€œGute Stimmung â€,è¿™æ˜¯å¾·è¯­ä¸­â€œå¥½å¿ƒæƒ…â€çš„æ„æ€ï¼Œæˆ‘å°†ç”¨æˆ·å±æ€§â€œæƒ…ç»ªâ€è®¾ç½®ä¸ºâ€œç§¯æâ€,å°†â€œè¯­è¨€â€è®¾ç½®ä¸ºâ€œenâ€ã€‚</p><p id="3c4d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å¿ƒæƒ…å‘é€å¯¹èŠå¤©æ¶ˆæ¯çš„å“åº”ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±ä¸ºè¿™ä¸ªåŠ ä¸ªè°ƒç”¨å§ã€‚</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="f6a9" class="mr lk iq mn b gy ms mt l mu mv">if ($sentiment_score &gt; 0.25) {<br/>    $responseText = "Good to hear that you are happy ğŸ˜€";<br/>    $this-&gt;sendChatResponse($msg['usernumber'], $responseText);<br/>}</span></pre><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a2254f78de0fd5bbe1c9a3432c74e8bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*vNDdIDNrTGVM7K0okNPlrg.png"/></div></figure><p id="07dc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æˆ‘å¸Œæœ›æ‚¨å¯¹NLP APIå¯èƒ½å¸¦æ¥çš„å·¨å¤§æˆå°±æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„å°è±¡ã€‚æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯:å½“ç„¶ä¹Ÿæœ‰å…¶ä»–ä¾›åº”å•†æä¾›ç±»ä¼¼çš„äº§å“ï¼Œå¦‚å¾®è½¯Azureã€IBM Watsonæˆ–AWSã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜ä¸çŸ¥é“å“ªä¸ªæœåŠ¡è¿”å›çš„ç»“æœæœ€å¥½ã€‚</p><p id="db9e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ¢ç´¢æ„‰å¿«ï¼</p></div></div>    
</body>
</html>