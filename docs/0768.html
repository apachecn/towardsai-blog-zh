<html>
<head>
<title>Using Twitter Rest APIs in Python to Search and Download Tweets in Bulk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Pythonä¸­çš„Twitter Rest APIsæ¥æ‰¹é‡æœç´¢å’Œä¸‹è½½Tweets</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://pub.towardsai.net/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk-da234b5f155a?source=collection_archive---------2-----------------------#2020-08-06">https://pub.towardsai.net/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk-da234b5f155a?source=collection_archive---------2-----------------------#2020-08-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7415" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-mining" rel="noopener ugc nofollow" target="_blank">æ•°æ®æŒ–æ˜</a>ï¼Œ<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">ç¼–ç¨‹</a></h2><div class=""/><div class=""><h2 id="6c1b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">äº†è§£å¦‚ä½•å¯¹æ¨æ–‡åº”ç”¨è¯­è¨€æ£€æµ‹å’Œæƒ…æ„Ÿåˆ†æ</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/8339733132c5457979af5a62abcb1396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4V2xEt3KRenVOE-_"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae lh" href="https://unsplash.com/@purzlbaum?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">ğŸ‡¨ğŸ‡­Â·å…‹åŠ³è¿ªå¥¥Â·æ–½ç“¦èŒ¨| @purzlbaum </a>åœ¨<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="c8fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">è·å–Twitteræ•°æ®</strong></p><p id="dfe5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®©æˆ‘ä»¬ä½¿ç”¨pythonä¸­çš„TweepyåŒ…ï¼Œè€Œä¸æ˜¯ç›´æ¥å¤„ç†Twitter APIã€‚æˆ‘ä»¬å°†å¯¹è¿™ä¸ªåŒ…åšçš„ä¸¤ä»¶äº‹æ˜¯ï¼Œæˆæƒæˆ‘ä»¬è‡ªå·±ä½¿ç”¨APIï¼Œç„¶åä½¿ç”¨å…‰æ ‡è®¿é—®twitteræœç´¢APIã€‚</p><p id="6aa7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®©æˆ‘ä»¬ç»§ç»­è£…è¿›å£è´§å§ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="09fd" class="mj mk it mf b gy ml mm l mn mo">import tweepy<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import numpy as np</span><span id="a90d" class="mj mk it mf b gy mp mm l mn mo">sns.set()<br/>%matplotlib inline</span></pre><h2 id="c9a1" class="mj mk it bd mq mr ms dn mt mu mv dp mw lr mx my mz lv na nb nc lz nd ne nf iz bi translated">Twitteræˆæƒ</h2><p id="f342" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">è¦ä½¿ç”¨Twitter APIï¼Œæ‚¨å¿…é¡»é¦–å…ˆæ³¨å†Œä»¥è·å¾—APIå¯†é’¥ã€‚è¦å®‰è£…Tweepyï¼Œåªéœ€é€šè¿‡pipå®‰è£…Tweepyã€‚Tweepyæ–‡æ¡£æœ€æ“…é•¿è§£é‡Šå¦‚ä½•è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä½†æ˜¯æˆ‘å°†ä»‹ç»åŸºæœ¬æ­¥éª¤ã€‚</p><p id="62c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ä¸€æ—¦ä½ æ³¨å†Œäº†ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ å°†ä¼šæ”¶åˆ°APIå¯†åŒ™ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨Tweepyæ¥è·å¾—ä¸€ä¸ªOAuthHandlerã€‚æˆ‘å°†å¯†é’¥å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„é…ç½®å­—å…¸ä¸­ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="cbee" class="mj mk it mf b gy ml mm l mn mo">config = {"twitterConsumerKey":"XXXX", "twitterConsumerSecretKey" :"XXXX"} <br/>auth = tweepy.OAuthHandler(config["twitterConsumerKey"], config["twitterConsumerSecretKey"]) <br/>redirect_url = auth.get_authorization_url() <br/>redirect_url</span></pre><p id="cdc1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æ—¢ç„¶æˆ‘ä»¬å·²ç»ä¸ºTweepyæä¾›äº†ç”ŸæˆOAuthHandlerçš„å¯†é’¥ï¼Œç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨è¯¥å¤„ç†ç¨‹åºæ¥è·å–ä¸€ä¸ªé‡å®šå‘URLã€‚ä»æµè§ˆå™¨ä¸­çš„è¾“å‡ºè½¬åˆ°URLï¼Œæ‚¨å¯ä»¥å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæˆæƒæ‚¨çš„å¸æˆ·ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è®¿é—®APIã€‚</p><p id="cd53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ä¸€æ—¦ä½ ç”¨è¯¥åº”ç”¨ç¨‹åºæˆæƒäº†ä½ çš„å¸æˆ·ï¼Œä½ å°†è·å¾—ä¸€ä¸ªPINã€‚ä½¿ç”¨Tweepyä¸­çš„é‚£ä¸ªæ•°å­—è®©å®ƒçŸ¥é“æ‚¨å·²ç»ç”¨APIæˆæƒäº†å®ƒã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="f06b" class="mj mk it mf b gy ml mm l mn mo">pin = "XXXX"<br/>auth.get_access_token(pin)</span></pre><h1 id="b6aa" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">æœç´¢æ¨æ–‡</h1><p id="702b" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">è·å¾—æˆæƒåï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æœç´¢æ‰€æœ‰åŒ…å«â€œè‹±èˆªâ€ä¸€è¯çš„æ¨æ–‡ï¼›æˆ‘ä»¬å·²å°†æœ€å¤§ç»“æœé™åˆ¶ä¸º1000ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="1cd5" class="mj mk it mf b gy ml mm l mn mo">query = 'British Airways'<br/>max_tweets = 10<br/>searched_tweets = [status for status in tweepy.Cursor(api.search, q=query,tweet_mode='extended').items(max_tweets)]</span><span id="9f21" class="mj mk it mf b gy mp mm l mn mo">search_dict = {"text": [], "author": [], "created_date": []}</span><span id="8c12" class="mj mk it mf b gy mp mm l mn mo">for item in searched_tweets:<br/>    if not item.retweet or "RT" not in item.full_text:<br/>        search_dict["text"].append(item.full_text)<br/>        search_dict["author"].append(item.author.name)<br/>        search_dict["created_date"].append(item.created_at)</span><span id="6b59" class="mj mk it mf b gy mp mm l mn mo">df = pd.DataFrame.from_dict(search_dict)<br/>df.head()</span><span id="88dc" class="mj mk it mf b gy mp mm l mn mo"># <!-- -->Out:<br/>    text                                                author      created_date<br/>0   @RwandAnFlyer @KenyanAviation @KenyaAirways @U...   Bkoskey     2019-03-06 10:06:14<br/>1   @PaulCol56316861 Hi Paul, I'm sorry we can't c...   British Airways     2019-03-06 10:06:09<br/>2   @AmericanAir @British_Airways do you agree wit...   Hat     2019-03-06 10:05:38<br/>3   @Hi_Im_AlexJ Hi Alex, I'm glad you've managed ...   British Airways     2019-03-06 10:02:58<br/>4   @ZRHworker @British_Airways @Schmidy_87 @zrh_a...   Stefan Paetow   2019-03-06 10:02:33</span></pre><h1 id="d989" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">è¯­è¨€æ£€æµ‹</h1><p id="e7dc" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">ä¸Šé¢çš„ä»£ç ä¸‹è½½çš„tweetså¯ä»¥æ˜¯ä»»ä½•è¯­è¨€ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨è¿™äº›æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„æ–‡æœ¬æŒ–æ˜ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡æ‰§è¡Œè¯­è¨€æ£€æµ‹æ¥å¯¹å…¶è¿›è¡Œåˆ†ç±»ã€‚</p><p id="f367" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">é€šå¸¸ï¼Œè¯­è¨€æ£€æµ‹æ˜¯ç”±åŸºäºæœ´ç´ è´å¶æ–¯ç®—æ³•æˆ–æ›´ç°ä»£çš„ç¥ç»ç½‘ç»œçš„é¢„è®­ç»ƒæ–‡æœ¬åˆ†ç±»å™¨æ¥æ‰§è¡Œçš„ã€‚Googleçš„<a class="ae lh" href="https://github.com/google/cld3" rel="noopener ugc nofollow" target="_blank">compact language detector library</a>æ˜¯ç”Ÿäº§çº§å·¥ä½œè´Ÿè½½çš„ç»ä½³é€‰æ‹©ï¼Œæ‚¨å¿…é¡»åœ¨ä¸åˆ°å‡ åˆ†é’Ÿçš„æ—¶é—´å†…åˆ†ææˆåƒä¸Šä¸‡çš„æ–‡æ¡£ã€‚ç„¶è€Œï¼Œè®¾ç½®èµ·æ¥æœ‰ç‚¹æ£˜æ‰‹ï¼Œå› æ­¤ï¼Œè®¸å¤šäººä¾èµ–äºè°ƒç”¨ç¬¬ä¸‰æ–¹æä¾›å•†å¦‚Algorithmiaçš„<a class="ae lh" href="https://algorithmia.com/algorithms/specrom/NaturalLanguageDetection" rel="noopener ugc nofollow" target="_blank">è¯­è¨€æ£€æµ‹API </a>ï¼Œè¯¥APIæ¯æœˆå¯å…è´¹ä½¿ç”¨æ•°ç™¾æ¬¡(éœ€è¦å…è´¹æ³¨å†Œï¼Œæ— éœ€ä¿¡ç”¨å¡)ã€‚</p><p id="ebc1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®©æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¿æŒç®€å•ï¼Œåªä½¿ç”¨ä¸€ä¸ªåä¸ºLangidçš„Pythonåº“ï¼Œå®ƒæ¯”ä¸Šé¢è®¨è®ºçš„é€‰é¡¹æ…¢å‡ ä¸ªæ•°é‡çº§ï¼Œä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­å¯¹æˆ‘ä»¬æ¥è¯´åº”è¯¥æ²¡é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬åªåˆ†æå¤§çº¦100æ¡æ¨æ–‡ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="5c2d" class="mj mk it mf b gy ml mm l mn mo">from langid.langid import LanguageIdentifier, model<br/>def get_lang(document):<br/>    identifier = LanguageIdentifier.from_modelstring(model, norm_probs=True)<br/>    prob_tuple = identifier.classify(document)<br/>    return prob_tuple[0]</span><span id="57a9" class="mj mk it mf b gy mp mm l mn mo">df["language"] = df["text"].apply(get_lang)</span></pre><p id="408b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ‘ä»¬å‘ç°è¾“å‡ºä¸­æœ‰å››ç§ç‹¬ç‰¹è¯­è¨€çš„æ¨æ–‡ï¼Œ100æ¡æ¨æ–‡ä¸­åªæœ‰45æ¡æ˜¯è‹±è¯­ï¼Œå¦‚ä¸‹æ‰€ç¤ºè¿›è¡Œè¿‡æ»¤ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="75b0" class="mj mk it mf b gy ml mm l mn mo">print(df["language"].unique())<br/>df_filtered = df[df["language"]=="en"]<br/>print(df_filtered.shape)</span><span id="42ce" class="mj mk it mf b gy mp mm l mn mo">#Out:<br/>array(['en', 'rw', 'nl', 'es'], dtype=object)<br/>(45, 4)</span></pre><h1 id="b103" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">è®©æƒ…ç»ªä¸ºæ¨æ–‡è¯„åˆ†</h1><p id="36d5" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰é¢éƒ¨åˆ†åˆ›å»ºçš„df_filteredï¼Œå¹¶é€šè¿‡é¢„å…ˆè®­ç»ƒçš„æƒ…æ„Ÿåˆ†æåº“è¿è¡Œå®ƒã€‚å‡ºäºè¯´æ˜çš„ç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨Textblobä¸­çš„ä¸€ä¸ªï¼Œä½†æ˜¯ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½¿ç”¨æ›´å‡†ç¡®çš„æƒ…ç»ªæ¨¡å‹ï¼Œå¦‚coreNLPä¸­çš„æ¨¡å‹ï¼Œæˆ–è€…ä½¿ç”¨Sklearnæˆ–Kerasè®­ç»ƒæ‚¨è‡ªå·±çš„æ¨¡å‹ã€‚</p><p id="3e1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">æˆ–è€…ï¼Œå¦‚æœä½ é€‰æ‹©é€šè¿‡APIé€”å¾„ï¼Œé‚£ä¹ˆåœ¨Algorithmiaä¸Šæœ‰ä¸€ä¸ªéå¸¸å¥½çš„<a class="ae lh" href="https://algorithmia.com/algorithms/specrom/GetSentimentsScorefromText" rel="noopener ugc nofollow" target="_blank">æƒ…ç»ªAPI </a>ã€‚</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="69db" class="mj mk it mf b gy ml mm l mn mo">from textblob import TextBlob</span><span id="8ebc" class="mj mk it mf b gy mp mm l mn mo">def get_sentiments(text):<br/>    blob = TextBlob(text)<br/><em class="nw">#     sent_dict = {}</em><br/><em class="nw">#     sent_dict["polarity"] = blob.sentiment.polarity</em><br/><em class="nw">#     sent_dict["subjectivity"] = blob.sentiment.subjectivity</em><br/>    <br/>    if blob.sentiment.polarity &gt; 0.1:<br/>        return 'positive'<br/>    elif blob.sentiment.polarity &lt; -0.1:<br/>        return 'negative'<br/>    else:<br/>        return 'neutral'</span><span id="04a6" class="mj mk it mf b gy mp mm l mn mo">def get_sentiments_score(text):<br/>    blob = TextBlob(text)<br/>    return blob.sentiment.polarity<br/>    <br/>df_filtered["sentiments"]=df_filtered["text"].apply(get_sentiments)<br/>df_filtered["sentiments_score"]=df_filtered["text"].apply(get_sentiments_score)<br/>df_filtered.head()<br/>#Out:<br/>    text                                                author          created_date    language    sentiments  sentiments_score<br/>0   @British_Airways Having some trouble with our ...   Rosie Smith     2019-03-06 10:24:57     en  neutral     0.025<br/>1   @djban001 This doesn't sound good, Daniel. Hav...   British Airways     2019-03-06 10:24:45     en  positive    0.550<br/>2   First #British Airways Flight to #Pakistan Wil...   Developing Pakistan     2019-03-06 10:24:43     en  positive    0.150<br/>3   I donâ€™t know why heâ€™s not happy. I thought he ...   Joyce Stevenson     2019-03-06 10:24:18     en  negative    -0.200<br/>4   Fancy winning a global holiday for you and a f...   Selective Travel Mgt ğŸŒ  2019-03-06 10:23:40     en  positive    0.360</span></pre><p id="fc79" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">è®©æˆ‘ä»¬ç»˜åˆ¶æƒ…ç»ªå¾—åˆ†å›¾ï¼Œçœ‹çœ‹äººä»¬ä¸ºâ€œè‹±å›½èˆªç©ºå…¬å¸â€å‘é€äº†å¤šå°‘è´Ÿé¢ã€ä¸­ç«‹å’Œæ­£é¢çš„æ¨æ–‡ã€‚æ‚¨ä¹Ÿå¯ä»¥å°†å…¶ä¿å­˜ä¸ºCSVæ–‡ä»¶ï¼Œä»¥ä¾¿ä»¥åè¿›ä¸€æ­¥å¤„ç†ã€‚</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6e782e185c52fcc67cf69fba392ae59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/0*ZaumfkVl73AGsOHY.jpg"/></div></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="641a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nw">åŸè½½äº2019å¹´2æœˆ1æ—¥</em><a class="ae lh" href="http://jaympatel.com/2019/02/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk/" rel="noopener ugc nofollow" target="_blank"><em class="nw">http://jaympatel.com</em></a><em class="nw">ã€‚</em></p></div></div>    
</body>
</html>