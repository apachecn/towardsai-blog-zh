<html>
<head>
<title>Detecting Traffic Lights using the Monk Object Detection Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Monkå¯¹è±¡æ£€æµ‹åº“æ£€æµ‹äº¤é€šç¯</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://pub.towardsai.net/detecting-traffic-lights-using-the-monk-object-detection-library-1321b113f37d?source=collection_archive---------5-----------------------#2020-10-19">https://pub.towardsai.net/detecting-traffic-lights-using-the-monk-object-detection-library-1321b113f37d?source=collection_archive---------5-----------------------#2020-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="c4e3" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/computer-vision" rel="noopener ugc nofollow" target="_blank">è®¡ç®—æœºè§†è§‰</a></h2><div class=""/><div class=""><h2 id="c2f0" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">è¿™ç¯‡æ–‡ç« æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨MONKå¯¹è±¡æ£€æµ‹åº“çš„ä¾‹å­ã€‚</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/af2bef9ca286f03d9fbc4baf04b174c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R9t67SAWYg_dFfEY"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">ç”±<a class="ae le" href="https://unsplash.com/@crisovalle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å…‹é‡Œæ–¯Â·å¥¥ç“¦å°”</a>åœ¨<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="eace" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¯¹äºè¿™ä¸ªé¡¹ç›®çš„ç¬”è®°æœ¬è®¿é—®<a class="ae le" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/blob/master/application_model_zoo/Example%20-%20Lara%20Traffic%20Lights%20Detection%20Dataset.ipynb" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ã€‚</p><p id="95e9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">æ¬²äº†è§£æ›´å¤šå…³äºåƒ§ä¾£å¯¹è±¡æ£€æµ‹çš„ç¤ºä¾‹ï¼Œè¯·è®¿é—®<a class="ae le" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/tree/master/application_model_zoo" rel="noopener ugc nofollow" target="_blank">æ­¤å¤„</a>ã€‚</p><h1 id="ab70" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">å…³äºé¡¹ç›®:</h1><p id="bc6e" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">åœ¨ä¸€ä¸ªæ— äººé©¾é©¶æ±½è½¦ã€äº¤é€šç¯ğŸš¦ä¼šæˆä¸ºè¿‡å»ã€‚ä½†åªè¦äººç±»åœ¨æ—è¾¹è¡Œé©¶ï¼Œè‡ªåŠ¨é©¾é©¶è½¦è¾†å°±å¿…é¡»éµå¾ªäººç±»åˆ¶å®šçš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™ä¹‹ä¸€æ˜¯éµå®ˆäº¤é€šä¿¡å·ç¯ã€‚è‡ªåŠ¨é©¾é©¶æ±½è½¦ğŸš—å¿…é¡»æ£€æµ‹å’Œè¯†åˆ«äº¤é€šç¯ï¼Œä»¥é¿å…äº‹æ•…å’Œè¡—é“ä¸Šçš„æ··ä¹±ã€‚<br/>è¿™æ˜¯æˆ‘æœ€è¿‘å¯¹Tessellate Imaging Monkå¯¹è±¡æ£€æµ‹åº“çš„è´¡çŒ®ã€‚æœŸå¾…å°†å…¶éƒ¨ç½²åˆ°è¾¹ç¼˜è®¾å¤‡ã€‚</p><h1 id="8155" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">å…³äºæ•°æ®é›†:</h1><p id="400e" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">åœ¨æ­¤å¯ä»¥æŸ¥çœ‹æ•°æ®é›†<a class="ae le" href="http://www.lara.prd.fr/benchmarks/trafficlightsrecognition" rel="noopener ugc nofollow" target="_blank">ã€‚æ•°æ®é›†æ–‡ä»¶åŒ…å«<strong class="lh ja">9168ä¸ªäº¤é€šç¯å®ä¾‹ï¼Œæ‰‹å·¥æ ‡è®°ä¸º</strong>ã€‚çº¢ç»¿ç¯ç»†èŠ‚å¦‚ä¸‹:<strong class="lh ja">3381â€œç»¿è‰²â€</strong>(å«<em class="my">â€˜è¡Œâ€™</em>)<strong class="lh ja">58â€œæ©™è‰²â€</strong>(å«<em class="my">â€˜è­¦å‘Šâ€™</em>)<strong class="lh ja">5280â€œçº¢è‰²â€</strong>(å«<em class="my">â€˜åœâ€™</em>)<strong class="lh ja">449â€œæš§æ˜§â€ã€‚</strong></a></p><h1 id="db53" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">é¡¹ç›®ç›®æ ‡:</h1><ol class=""><li id="58e6" class="mz na iq lh b li mt ll mu lo nb ls nc lw nd ma ne nf ng nh bi translated">å®‰è£…<a class="ae le" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank">å’Œå°šç‰©ä½“æ£€æµ‹åº“</a></li><li id="8e14" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹æ¥æ£€æµ‹äº¤é€šç¯ã€‚</li><li id="ec6d" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">ä»å¤´å¼€å§‹è®­ç»ƒäº¤é€šç¯æ£€æµ‹æ¨¡å‹ã€‚</li></ol><h2 id="4fa6" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">1.å®‰è£…åƒ§ä¾£å›¾ä¹¦é¦†</h2><p id="5ec6" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">è¿è¡Œè¿™äº›å‘½ä»¤</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="3073" class="nn mc iq nz b gy od oe l of og">!git clone <a class="ae le" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Tessellate-Imaging/Monk_Object_Detection.git</a></span><span id="9c62" class="nn mc iq nz b gy oh oe l of og">!cd Monk_Object_Detection/16_mmdet/installation</span></pre><p id="cbe9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶å¹¶è¿è¡Œ</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="076b" class="nn mc iq nz b gy od oe l of og">!chmod +x install.sh &amp;&amp; ./install.sh</span></pre><h2 id="fa3a" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">2.ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹æ¥æ£€æµ‹äº¤é€šç¯ã€‚</h2><p id="8a49" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">è¦ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹åœ¨æµ‹è¯•å›¾åƒä¸ŠåŠ è½½å’Œè¿è¡Œæ¨ç†ï¼Œè¯·éµå¾ªä»¥ä¸‹ä»£ç ã€‚</p><p id="e6af" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¯¼å…¥MONKå¯¹è±¡æ£€æµ‹å¹¶åˆ›å»ºä¸€ä¸ªæ¨æ–­ç±»çš„å¯¹è±¡ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="0401" class="nn mc iq nz b gy od oe l of og">import os<br/>import sys<br/>sys.path.append("Monk_Object_Detection/16_mmdet/lib")</span><span id="8a7d" class="nn mc iq nz b gy oh oe l of og">from infer_engine import Infer<br/>gtf = Infer();</span></pre><p id="fa6e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">ä»é©±åŠ¨å™¨ä¸‹è½½é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹å¹¶è§£å‹ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="d04f" class="nn mc iq nz b gy od oe l of og">! wget --load-cookies /tmp/cookies.txt "<a class="ae le" href="https://docs.google.com/uc?export=download&amp;confirm=$(wget" rel="noopener ugc nofollow" target="_blank">https://docs.google.com/uc?export=download&amp;confirm=$(wget</a> --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate '<a class="ae le" href="https://docs.google.com/uc?export=download&amp;id=1XLSAp7YAYBY8xwKURiehj_uerHTJeq5n'" rel="noopener ugc nofollow" target="_blank">https://docs.google.com/uc?export=download&amp;id=1XLSAp7YAYBY8xwKURiehj_uerHTJeq5n'</a> -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&amp;id=1XLSAp7YAYBY8xwKURiehj_uerHTJeq5n" -O obj_traffic2_trained.zip &amp;&amp; rm -rf /tmp/cookies.txt</span><span id="f8b9" class="nn mc iq nz b gy oh oe l of og">! unzip -qq obj_traffic2_trained.zip</span></pre><p id="82a3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">åŠ è½½æ¨¡å‹å‚æ•°ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="4b20" class="nn mc iq nz b gy od oe l of og">gtf.Model_Params("work_dirs/config_updated/config_updated.py", <br/>                 "work_dirs/config_updated/latest.pth")</span></pre><p id="0a3b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¯¹æ‚¨æƒ³è¦çš„å›¾åƒè¿è¡ŒPredict()å‡½æ•°ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="65e5" class="nn mc iq nz b gy od oe l of og">result = gtf.Predict(img_path="Test_images/test1.jpg",<br/>           out_img_path="result.jpg",<br/>           thresh=0.8);<br/>from IPython.display import Image<br/>Image(filename='result.jpg')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/0305a880e1b2c67c014eb2d992afc624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qt4YtIQs1l-6KRFgVZ1Pjw.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/2ef6f0f00e2ccccf6de4822936ba013f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DJGkAgMOaosEV91c64ZTQ.png"/></div></div></figure><h1 id="ba57" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">ä»å¤´å¼€å§‹è®­ç»ƒäº¤é€šç¯æ£€æµ‹æ¨¡å‹</h1><h2 id="2887" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">æ¶‰åŠçš„æ­¥éª¤</h2><ol class=""><li id="f069" class="mz na iq lh b li mt ll mu lo nb ls nc lw nd ma ne nf ng nh bi translated">ä¸‹è½½æ•°æ®é›†</li><li id="e9e4" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">å°†CVMLæ ‡æ³¨æ ¼å¼è½¬æ¢ä¸ºCOCOæ ¼å¼</li><li id="ae16" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">ä½¿ç”¨<a class="ae le" href="https://github.com/open-mmlab/mmdetection" rel="noopener ugc nofollow" target="_blank"> MMDet </a>è®­ç»ƒæ¨¡å‹</li></ol><h2 id="60d8" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">1.ä¸‹è½½æ•°æ®é›†</h2><p id="d07f" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">æ•°æ®é›†å­¦åˆ†:<a class="ae le" href="http://www.lara.prd.fr/benchmarks/trafficlightsrecognition" rel="noopener ugc nofollow" target="_blank">çº¢ç»¿ç¯è¯†åˆ«(TLR)å…¬å…±åŸºå‡†</a>ã€‚ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ•°æ®é›†å¯ä»¥ä¸‹è½½åˆ°ä½ çš„æœºå™¨ä¸Šã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="b1c7" class="nn mc iq nz b gy od oe l of og">!wget <a class="ae le" href="http://s150102174.onlinehome.fr/Lara/files/Lara_UrbanSeq1_JPG.zip" rel="noopener ugc nofollow" target="_blank">http://s150102174.onlinehome.fr/Lara/files/Lara_UrbanSeq1_JPG.zip</a></span></pre><p id="9753" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">è§£å‹ç¼©æ•°æ®é›†:</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="fe18" class="nn mc iq nz b gy od oe l of og">!unzip Lara_UrbanSeq1_JPG.zip</span></pre><h2 id="5e02" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">2.è½¬æ¢CVMLåˆ°å¯å¯æ ¼å¼ã€‚</h2><p id="1d6d" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">è¿™ä¸€æ­¥æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæ•°æ®é›†çš„æ ‡æ³¨æ˜¯CVMLæ ¼å¼ï¼Œå› æ­¤éœ€è¦è½¬æ¢ä¸ºCOCOæ ¼å¼ã€‚</p><p id="f0dc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒæœ¬åšå®¢:<a class="ae le" href="https://medium.com/towards-artificial-intelligence/cvml-annotation-what-it-is-and-how-to-convert-it-7b818dc30c9f" rel="noopener"> CVMLæ³¨è§£â€”â€”ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Œå¦‚ä½•è½¬æ¢ï¼Ÿ</a></p><p id="5ea3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å°†CVMLè½¬æ¢ä¸ºåƒ§ä¾£ç±»å‹çš„ä»£ç </p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="08f6" class="nn mc iq nz b gy od oe l of og">import os<br/>import sys<br/>import numpy as np<br/>import pandas as pd<br/>import xmltodict<br/>import json<br/>from tqdm.notebook import tqdm<br/>import collections<br/>from pycocotools.coco import COCO</span><span id="a473" class="nn mc iq nz b gy oh oe l of og">img_dir = "Lara3D_UrbanSeq1_JPG/";</span><span id="d069" class="nn mc iq nz b gy oh oe l of og">annoFile="Lara_UrbanSeq1_GroundTruth_cvml.xml"<br/>f = open(annoFile, 'r');<br/>my_xml = f.read();<br/>anno = dict(dict(xmltodict.parse(my_xml))["dataset"])</span><span id="82de" class="nn mc iq nz b gy oh oe l of og">combined=[]<br/>count=0;<br/>for frame in tqdm(anno['frame']):<br/>    fname=file_content[count].strip()<br/>    count+=1<br/>    label_str = "";<br/>    width=640<br/>    height=480<br/>    if(type(frame["objectlist"]) ==collections.OrderedDict):<br/>        if(type(frame["objectlist"]['object']) == list):<br/>            for j,i in enumerate(frame['objectlist']['object']):<br/>                x1=max(int(i['box']['<a class="ae le" href="http://twitter.com/xc" rel="noopener ugc nofollow" target="_blank">@xc</a>'])-int(i['box']['<a class="ae le" href="http://twitter.com/w" rel="noopener ugc nofollow" target="_blank">@w</a>'])/2,0)<br/>                y1=max(int(i['box']['<a class="ae le" href="http://twitter.com/yc" rel="noopener ugc nofollow" target="_blank">@yc</a>'])-int(i['box']['<a class="ae le" href="http://twitter.com/h" rel="noopener ugc nofollow" target="_blank">@h</a>'])/2,0)<br/>                x2=min(int(i['box']['<a class="ae le" href="http://twitter.com/xc" rel="noopener ugc nofollow" target="_blank">@xc</a>'])+int(i['box']['<a class="ae le" href="http://twitter.com/w" rel="noopener ugc nofollow" target="_blank">@w</a>'])/2,width)<br/>                y2=min(int(i['box']['<a class="ae le" href="http://twitter.com/yc" rel="noopener ugc nofollow" target="_blank">@yc</a>'])+int(i['box']['<a class="ae le" href="http://twitter.com/h" rel="noopener ugc nofollow" target="_blank">@h</a>'])/2,height)<br/>                label=i['hypothesislist']['hypothesis']['subtype']['#text']<br/>                label_str+=str(x1)+" "+str(y1)+" "+str(x2)+" "+str(y2)+" "+label+" "</span><span id="ab68" class="nn mc iq nz b gy oh oe l of og">else:<br/>            x1=max(0,int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/xc" rel="noopener ugc nofollow" target="_blank">@xc</a>'])-int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/w" rel="noopener ugc nofollow" target="_blank">@w</a>'])/2)<br/>            y1=max(0,int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/yc" rel="noopener ugc nofollow" target="_blank">@yc</a>'])-int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/h" rel="noopener ugc nofollow" target="_blank">@h</a>'])/2)<br/>            x2=min(width,int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/xc" rel="noopener ugc nofollow" target="_blank">@xc</a>'])+int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/w" rel="noopener ugc nofollow" target="_blank">@w</a>'])/2)<br/>            y2=min(height,int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/yc" rel="noopener ugc nofollow" target="_blank">@yc</a>'])+int(frame["objectlist"]['object']['box']['<a class="ae le" href="http://twitter.com/h" rel="noopener ugc nofollow" target="_blank">@h</a>'])/2)<br/>            label=frame["objectlist"]['object']['hypothesislist']['hypothesis']['subtype']['#text']<br/>            label_str += str(x1)+" "+str(y1)+" "+str(x2)+" "+str(y2)+" " + label<br/>        <br/>    combined.append([fname,label_str.strip()])</span><span id="1fb2" class="nn mc iq nz b gy oh oe l of og">df = pd.DataFrame(combined, columns = ['ID', 'Label']);<br/>df.to_csv("train_labels.csv", index=False);</span></pre><p id="61a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å’Œå°šåˆ°å¯å¯ç±»å‹</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="f7bc" class="nn mc iq nz b gy od oe l of og">import os<br/>import numpy as np <br/>import cv2<br/>import dicttoxml<br/>import xml.etree.ElementTree as ET<br/>from xml.dom.minidom import parseString<br/>from tqdm import tqdm<br/>import shutil<br/>import json<br/>import pandas as pd</span><span id="befc" class="nn mc iq nz b gy oh oe l of og">root = "./";<br/>img_dir = "Lara3D_UrbanSeq1_JPG/";<br/>anno_file = "train_labels.csv";</span><span id="2133" class="nn mc iq nz b gy oh oe l of og">dataset_path = root;<br/>images_folder = root + "/" + img_dir;<br/>annotations_path = root + "/annotations/";</span><span id="7961" class="nn mc iq nz b gy oh oe l of og">if not os.path.isdir(annotations_path):<br/>    os.mkdir(annotations_path)<br/>    <br/>input_images_folder = images_folder;<br/>input_annotations_path = root + "/" + anno_file;</span><span id="5360" class="nn mc iq nz b gy oh oe l of og">output_dataset_path = root;<br/>output_image_folder = input_images_folder;<br/>output_annotation_folder = annotations_path;</span><span id="7147" class="nn mc iq nz b gy oh oe l of og">tmp = img_dir.replace("/", "");<br/>output_annotation_file = output_annotation_folder + "/instances_" + tmp + ".json";<br/>output_classes_file = output_annotation_folder + "/classes.txt";</span><span id="2183" class="nn mc iq nz b gy oh oe l of og">if not os.path.isdir(output_annotation_folder):<br/>    os.mkdir(output_annotation_folder);</span><span id="c8f7" class="nn mc iq nz b gy oh oe l of og">df = pd.read_csv(input_annotations_path);<br/>columns = df.columns</span><span id="e378" class="nn mc iq nz b gy oh oe l of og">delimiter = " ";</span><span id="6e10" class="nn mc iq nz b gy oh oe l of og">list_dict = [];<br/>anno = [];<br/>for i in range(len(df)):<br/>    img_name = df[columns[0]][i];<br/>    labels = df[columns[1]][i];<br/>    tmp = str(labels).split(delimiter);<br/>    for j in range(len(tmp)//5):<br/>        label = tmp[j*5+4];<br/>        if(label not in anno):<br/>            anno.append(label);<br/>    anno = sorted(anno)<br/>    <br/>for i in tqdm(range(len(anno))):<br/>    tmp = {};<br/>    tmp["supercategory"] = "master";<br/>    tmp["id"] = i;<br/>    tmp["name"] = anno[i];<br/>    list_dict.append(tmp);</span><span id="7051" class="nn mc iq nz b gy oh oe l of og">anno_f = open(output_classes_file, 'w');<br/>for i in range(len(anno)):<br/>    anno_f.write(anno[i] + "\n");<br/>anno_f.close();</span><span id="3be4" class="nn mc iq nz b gy oh oe l of og">coco_data = {};<br/>coco_data["type"] = "instances";<br/>coco_data["images"] = [];<br/>coco_data["annotations"] = [];<br/>coco_data["categories"] = list_dict;<br/>image_id = 0;<br/>annotation_id = 0;</span><span id="5eee" class="nn mc iq nz b gy oh oe l of og">for i in tqdm(range(len(df))):<br/>    img_name = df[columns[0]][i];<br/>    labels = df[columns[1]][i];<br/>    tmp = str(labels).split(delimiter);<br/>    image_in_path = input_images_folder + "/" + img_name;<br/>    img = cv2.imread(image_in_path, 1);<br/>    h, w, c = img.shape;</span><span id="7f25" class="nn mc iq nz b gy oh oe l of og">images_tmp = {};<br/>    images_tmp["file_name"] = img_name;<br/>    images_tmp["height"] = h;<br/>    images_tmp["width"] = w;<br/>    images_tmp["id"] = image_id;<br/>    coco_data["images"].append(images_tmp);</span><span id="022d" class="nn mc iq nz b gy oh oe l of og">for j in range(len(tmp)//5):<br/>        x1 = float(tmp[j*5+0]);<br/>        y1 = float(tmp[j*5+1]);<br/>        x2 = float(tmp[j*5+2]);<br/>        y2 = float(tmp[j*5+3]);<br/>        label = tmp[j*5+4];<br/>        annotations_tmp = {};<br/>        annotations_tmp["id"] = annotation_id;<br/>        annotation_id += 1;<br/>        annotations_tmp["image_id"] = image_id;<br/>        annotations_tmp["segmentation"] = [];<br/>        annotations_tmp["ignore"] = 0;<br/>        annotations_tmp["area"] = (x2-x1)*(y2-y1);<br/>        annotations_tmp["iscrowd"] = 0;<br/>        annotations_tmp["bbox"] = [x1, y1, x2-x1, y2-y1];<br/>        annotations_tmp["category_id"] = anno.index(label);</span><span id="a7e7" class="nn mc iq nz b gy oh oe l of og">coco_data["annotations"].append(annotations_tmp)<br/>    image_id += 1;</span><span id="dacd" class="nn mc iq nz b gy oh oe l of og">outfile =  open(output_annotation_file, 'w');<br/>json_str = json.dumps(coco_data, indent=4);<br/>outfile.write(json_str);<br/>outfile.close();</span></pre><h1 id="b987" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">2.åŸ¹è®­æ¨¡å¼</h1><p id="55d6" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">åŠ è½½monkå¹¶åˆ›å»ºä¸€ä¸ªæ£€æµ‹å™¨ç±»çš„å¯¹è±¡ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="de8b" class="nn mc iq nz b gy od oe l of og">import os<br/>import sys<br/>sys.path.append(â€œMonk_Object_Detection/16_mmdet/libâ€)</span><span id="328d" class="nn mc iq nz b gy oh oe l of og">from train_engine import Detector<br/>gtf = Detector();</span></pre><p id="9793" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">æŸ¥æ‰¾æ‰€éœ€çš„æ–‡ä»¶ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="d367" class="nn mc iq nz b gy od oe l of og">img_dir = "Lara3D_UrbanSeq1_JPG";<br/>annofile = "annotations/instances_Lara3D_UrbanSeq1_JPG.json"<br/>class_file = "annotations/classes.txt"</span></pre><p id="b9d9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">åŠ è½½æ•°æ®é›†ã€ç»™å®šæ•°æ®é›†å‚æ•°ã€åŠ è½½æ¨¡å‹æ¶æ„ä»¥åŠè°ƒæ•´è¶…å‚æ•°:</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="015d" class="nn mc iq nz b gy od oe l of og">gtf.Train_Dataset(img_dir, annofile, class_file);<br/>gtf.Dataset_Params(batch_size=8, num_workers=2);<br/>gtf.Model_Params(model_name="faster_rcnn_fpn50");<br/>gtf.Hyper_Params(lr=0.02, momentum=0.9, weight_decay=0.0001);</span></pre><p id="c32f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¼€å§‹åŸ¹è®­:</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="9aae" class="nn mc iq nz b gy od oe l of og">gtf.Training_Params(num_epochs=50, val_interval=1);<br/>gtf.Train();</span></pre><h2 id="d30d" class="nn mc iq bd md no np dn mh nq nr dp ml lo ns nt mn ls nu nv mp lw nw nx mr iw bi translated">3.å¯¹æµ‹è¯•å›¾åƒè¿›è¡Œæ¨ç†</h2><p id="b140" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">è¦ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹åœ¨æµ‹è¯•å›¾åƒä¸ŠåŠ è½½å’Œè¿è¡Œæ¨ç†ï¼Œè¯·éµå¾ªä»¥ä¸‹ä»£ç ã€‚</p><p id="ef83" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¯¼å…¥MONKå¯¹è±¡æ£€æµ‹å¹¶åˆ›å»ºä¸€ä¸ªæ¨æ–­ç±»çš„å¯¹è±¡ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="5836" class="nn mc iq nz b gy od oe l of og">import os<br/>import sys<br/>sys.path.append(â€œMonk_Object_Detection/16_mmdet/libâ€)</span><span id="8160" class="nn mc iq nz b gy oh oe l of og">from infer_engine import Infer<br/>gtf=Infer();</span></pre><p id="13f6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">åŠ è½½æ¨¡å‹å‚æ•°ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="4f52" class="nn mc iq nz b gy od oe l of og">gtf.Model_Params("work_dirs/config_updated/config_updated.py", <br/>                 "work_dirs/config_updated/latest.pth")</span></pre><p id="80b5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¯¹æ‚¨æƒ³è¦çš„å›¾åƒè¿è¡ŒPredict()å‡½æ•°ã€‚</p><pre class="kp kq kr ks gt ny nz oa ob aw oc bi"><span id="5c75" class="nn mc iq nz b gy od oe l of og">result = gtf.Predict(img_path="Test_images/test1.jpg",<br/>           out_img_path="result.jpg",<br/>           thresh=0.8);<br/>from IPython.display import Image<br/>Image(filename='result.jpg')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/0305a880e1b2c67c014eb2d992afc624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qt4YtIQs1l-6KRFgVZ1Pjw.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/2ef6f0f00e2ccccf6de4822936ba013f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DJGkAgMOaosEV91c64ZTQ.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/ab523682207907cd22c025f0d67798ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3SzmagRDQq814-fIIWCyw.png"/></div></div></figure><p id="f88b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">å¦‚éœ€æ›´å¤šæµ‹è¯•å›¾ç‰‡ï¼Œæˆ–æŸ¥çœ‹å®Œæ•´ç¬”è®°æœ¬ï¼Œè¯·è®¿é—®<a class="ae le" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/blob/master/application_model_zoo/Example%20-%20Lara%20Traffic%20Lights%20Detection%20Dataset.ipynb" rel="noopener ugc nofollow" target="_blank">æ­¤å¤„</a>ã€‚</p><h1 id="f85a" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">ç»“è®º</h1><ol class=""><li id="fa93" class="mz na iq lh b li mt ll mu lo nb ls nc lw nd ma ne nf ng nh bi translated">Monk libraryè®©å­¦ç”Ÿã€ç ”ç©¶äººå‘˜å’Œç«äº‰å¯¹æ‰‹å¯ä»¥éå¸¸è½»æ¾åœ°åˆ›å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¹¶å°è¯•ä¸åŒçš„è¶…å‚æ•°è°ƒæ•´æ¥æé«˜æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚</li><li id="dc49" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">é¢„å…ˆè®­ç»ƒçš„æ¨¡å‹å¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ï¼Œè€Œæ— éœ€è¿›å…¥æ¨¡å‹åˆ›å»ºéƒ¨åˆ†ã€‚</li><li id="7b7c" class="mz na iq lh b li ni ll nj lo nk ls nl lw nm ma ne nf ng nh bi translated">ä½¿ç”¨Monkä½¿è¿™ä¸ªè¿‡ç¨‹å˜å¾—ç®€å•ï¼Œè€—æ—¶æ›´å°‘ã€‚</li></ol><h1 id="1f16" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">æ„Ÿè°¢é˜…è¯»ã€‚</h1><p id="66e6" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">å¦‚æœä½ è¯»åˆ°è¿™é‡Œï¼Œè¯·ä¸ºè¿™ç¯‡æ–‡ç« é¼“æŒã€‚è¿˜æœ‰ï¼Œåœ¨<a class="ae le" href="https://www.linkedin.com/in/rohit96/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>ä¸Šå’Œæˆ‘è”ç³»ã€‚</p></div></div>    
</body>
</html>