<html>
<head>
<title>Pyspark Handle Dataset With Columns Separator in Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ•°æ®ä¸­å¸¦æœ‰åˆ—åˆ†éš”ç¬¦çš„Pysparkå¥æŸ„æ•°æ®é›†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://pub.towardsai.net/pyspark-handle-dataset-with-columns-separator-in-data-c98069d131aa?source=collection_archive---------4-----------------------#2021-01-11">https://pub.towardsai.net/pyspark-handle-dataset-with-columns-separator-in-data-c98069d131aa?source=collection_archive---------4-----------------------#2021-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="023b" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">ç¼–ç¨‹</a></h2><div class=""/><p id="e523" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">è¿™ç¯‡åšå®¢çš„ç›®çš„æ˜¯å¤„ç†æ•°æ®é›†ä¸­å‡ºç°åˆ—åˆ†éš”ç¬¦æˆ–å®šç•Œç¬¦çš„ç‰¹æ®Šæƒ…å†µã€‚å¯¹äºPysparkå¼€å‘äººå‘˜æ¥è¯´ï¼Œå¤„ç†è¿™ç§ç±»å‹çš„æ•°æ®é›†æœ‰æ—¶æ˜¯ä¸€ä»¶ä»¤äººå¤´ç–¼çš„äº‹æƒ…ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œè¿™æ˜¯å¿…é¡»è¦å¤„ç†çš„ã€‚åœ¨æˆ‘çš„åšå®¢ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘åº”å¯¹æŒ‘æˆ˜çš„æ–¹æ³•ï¼Œæˆ‘ä¹äºå­¦ä¹ ï¼Œæ‰€ä»¥ä¹Ÿè¯·åˆ†äº«ä½ çš„æ–¹æ³•ã€‚</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/998934bb933cfa1ec302f8c8e84fb36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*z_nqJKzCsomwH1Qvb9p9EA.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">æ¥æº:<a class="ae lg" href="https://spark.apache.org/docs/latest/api/python/index.html" rel="noopener ugc nofollow" target="_blank"> PySpark </a></figcaption></figure><p id="9d60" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ•°æ®é›†åŸºæœ¬å¦‚ä¸‹å›¾æ‰€ç¤º:</p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="4961" class="lm ln iq li b gy lo lp l lq lr">#first line is the header</span><span id="7c6d" class="lm ln iq li b gy ls lp l lq lr">NAME|AGE|DEP<br/>Vivek|Chaudhary|32|BSC<br/>John|Morgan|30|BE<br/>Ashwin|Rao|30|BE</span></pre><p id="548c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ•°æ®é›†åŒ…å«ç”±åˆ†éš”ç¬¦â€œ|â€åˆ†éš”çš„ä¸‰åˆ—<strong class="jy ja">ã€ã€å§“åã€‘ã€ã€å¹´é¾„ã€‘ã€</strong>ã€‚å¦‚æœæˆ‘ä»¬å…³æ³¨æ•°æ®é›†ï¼Œå®ƒè¿˜åŒ…å«â€œ|â€ä½œä¸ºåˆ—å<strong class="jy ja">ã€‚</strong></p><p id="92eb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">è®©æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹çœ‹å¦‚ä½•è¿›è¡Œç›¸åŒçš„æ“ä½œ:</p><p id="de7a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">æ­¥éª¤1ã€‚ä½¿ç”¨sparkçš„read.csv()æ–¹æ³•è¯»å–æ•°æ®é›†:</strong></p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="aceb" class="lm ln iq li b gy lo lp l lq lr">#create spark session </span><span id="7bd4" class="lm ln iq li b gy ls lp l lq lr">import pyspark<br/>from pyspark.sql import SparkSession<br/>spark=SparkSession.builder.appName(â€˜delimitâ€™).getOrCreate()</span></pre><p id="2092" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ä¸Šé¢çš„å‘½ä»¤å¸®åŠ©æˆ‘ä»¬è¿æ¥åˆ°sparkç¯å¢ƒï¼Œå¹¶è®©æˆ‘ä»¬ä½¿ç”¨spark.read.csv()è¯»å–æ•°æ®é›†</p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="99a4" class="lm ln iq li b gy lo lp l lq lr">#create dataframe</span><span id="5b20" class="lm ln iq li b gy ls lp l lq lr">df=spark.read.option(â€˜delimiterâ€™,â€™|â€™).csv(râ€™&lt;path&gt;\delimit_data.txtâ€™,inferSchema=True,header=True)</span><span id="3e37" class="lm ln iq li b gy ls lp l lq lr">df.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/166d9bbb99523d20dbd27b149193e87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/1*e-5vr_hGpk_2wLwyGtr7cA.png"/></div></figure><p id="b7cb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶å°†æ•°æ®æ”¾å…¥å†…å­˜åï¼Œå®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚ä½†æ˜¯ç­‰ç­‰ï¼Œæœ€åä¸€åˆ—æ•°æ®åœ¨å“ªé‡Œï¼Œåˆ—<strong class="jy ja">å¹´é¾„</strong>å¿…é¡»æœ‰ä¸€ä¸ªæ•´æ•°æ•°æ®ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°äº†åˆ«çš„ä¸œè¥¿ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚ä¹±ä¸ƒå…«ç³Ÿå®Œå…¨ä¸åŒ¹é…ï¼Œä¸æ˜¯å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¸€å›¢ç³Ÿã€‚è®©æˆ‘æƒ³èµ·ç¢§ç¢§Â·é›·å…‹è¨çš„æ­Œã€Šæˆ‘ä¸€å›¢ç³Ÿã€‹ğŸ˜‚ğŸ˜‚</p><p id="c34a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p id="5940" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">æ­¥éª¤2ã€‚å†æ¬¡è¯»å–æ•°æ®ï¼Œä½†è¿™æ¬¡ä½¿ç”¨read.text()æ–¹æ³•:</strong></p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="0144" class="lm ln iq li b gy lo lp l lq lr">df=spark.read.text(râ€™C:\Users\lenovo\Python_Pyspark_Corp_Training\delimit_data.txtâ€™)<br/>df.show(truncate=0)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/60e8f422b82d0672c45789881352a783.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*w1Q_n4I85MIy8MsjZWOoeg.png"/></div></figure><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="be95" class="lm ln iq li b gy lo lp l lq lr">#extract first row as this is our header<br/>head=df.first()[0]</span><span id="bf15" class="lm ln iq li b gy ls lp l lq lr">schema=[â€˜fnameâ€™,â€™lnameâ€™,â€™ageâ€™,â€™depâ€™]<br/>print(schema)</span><span id="0a18" class="lm ln iq li b gy ls lp l lq lr">Output: ['fname', 'lname', 'age', 'dep']</span></pre><p id="7508" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ä¸‹ä¸€æ­¥æ˜¯æ ¹æ®åˆ—åˆ†éš”ç¬¦åˆ†å‰²æ•°æ®é›†:</p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="ae83" class="lm ln iq li b gy lo lp l lq lr">#filter the header, separate the columns and apply the schema<br/>df_new=df.filter(df[â€˜valueâ€™]!=head).rdd.map(lambda x:x[0].split(â€˜|â€™)).toDF(schema)<br/>df_new.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/560d3717f9b81907eefaaa6a32a7c84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*QHMlHBE3VKZY4o_88YSA7g.png"/></div></figure><p id="cccb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåˆ†ç¦»å‡ºäº†<strong class="jy ja">èŒæ ª</strong>ã€‚ç­‰ç­‰ä»€ä¹ˆ<strong class="jy ja">åº”å˜</strong>ï¼Ÿä¸ï¼Œä¼™è®¡ï¼Œè¿™ä¸æ˜¯ç”µæ™•ç—…æ¯’ï¼Œè¿™åªæ˜¯æ–‡æœ¬æ•°æ®ã€‚ç•™ç€å§ï¼Œç®€å•çš„ä¼™ä¼´ã€‚ğŸ˜œğŸ˜œ</p><p id="3ccd" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†ç®¡é“â€œ|â€åˆ†éš”çš„åˆ—(â€œåç§°â€)æ•°æ®åˆ†æˆä¸¤åˆ—ã€‚ç°åœ¨æ•°æ®æ›´åŠ å¹²å‡€ï¼Œå¯ä»¥è½»æ¾æ’­æ”¾ã€‚</p><p id="bdcd" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ¥ä¸‹æ¥ï¼Œè¿æ¥åˆ—<strong class="jy ja">â€œfnameâ€</strong>å’Œ<strong class="jy ja">â€œlnameâ€</strong>:</p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="a88b" class="lm ln iq li b gy lo lp l lq lr">from pyspark.sql.functions import concat, col, lit<br/>df1=df_new.withColumn(â€˜fullnameâ€™,concat(col(â€˜fnameâ€™),lit(â€œ|â€),col(â€˜lnameâ€™)))<br/>df1.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/62d4653883262b46980d34a768611650.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*S0l3tA2OsAj1k_dvU5KF1w.png"/></div></figure><p id="d264" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">ä¸ºäº†éªŒè¯æ•°æ®è½¬æ¢ï¼Œæˆ‘ä»¬å°†æŠŠè½¬æ¢åçš„æ•°æ®é›†å†™å…¥ä¸€ä¸ªCSVæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨<strong class="jy ja"> read.csv() </strong>æ–¹æ³•è¯»å–å®ƒã€‚</p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="29eb" class="lm ln iq li b gy lo lp l lq lr">df1.write.option(â€˜sepâ€™,â€™|â€™).mode(â€˜overwriteâ€™).option(â€˜headerâ€™,â€™trueâ€™).csv(râ€™&lt;<em class="lx">file_path</em>&gt;\cust_sep.csvâ€™)</span></pre><p id="893c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">ä¸‹ä¸€æ­¥æ˜¯æ•°æ®éªŒè¯:</strong></p><pre class="kv kw kx ky gt lh li lj lk aw ll bi"><span id="c7e5" class="lm ln iq li b gy lo lp l lq lr">df=spark.read.option(â€˜delimiterâ€™,â€™|â€™).csv(r&lt;<em class="lx">filepath</em>&gt;,inferSchema=True,header=True)<br/>df.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/9bd3e0d23fc68368616ecf5f25993f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*mEHKQqXq7xtsocQ5SdyW1w.png"/></div></figure><p id="09b6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ•°æ®ç°åœ¨çœ‹èµ·æ¥ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ä¸€ä¸ªå°ç»ƒä¹ ï¼Œå°è¯•ä½¿ç”¨ä¸åŒçš„åˆ†éš”ç¬¦ï¼Œå¦‚æœå‘ç°ä»»ä½•å¼‚å¸¸ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚è¿™ä¸ªåšå®¢åˆ°æ­¤ä¸ºæ­¢ã€‚ä¸‹æ¬¡ä¼šæœ‰ä¸åŒçš„åœºæ™¯ã€‚</p><p id="6242" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">æ„Ÿè°¢å¤§å®¶é˜…è¯»æˆ‘çš„åšå®¢ã€‚è¯·åˆ†äº«æ‚¨çš„è§‚ç‚¹æˆ–åé¦ˆã€‚</p></div></div>    
</body>
</html>