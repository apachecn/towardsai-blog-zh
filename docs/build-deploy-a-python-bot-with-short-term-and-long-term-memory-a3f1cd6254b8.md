# æ„å»ºå’Œéƒ¨ç½²ä¸€ä¸ªå…·æœ‰çŸ­æœŸå’Œé•¿æœŸè®°å¿†çš„ç”µæŠ¥æœºå™¨äºº

> åŸæ–‡ï¼š<https://pub.towardsai.net/build-deploy-a-python-bot-with-short-term-and-long-term-memory-a3f1cd6254b8?source=collection_archive---------0----------------------->

![](img/bf7a59d41b19f964ce71b34753c515bf.png)

## [ç¼–ç¨‹](https://towardsai.net/p/category/programming)

## ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Œç”¨ Python è®°ä½å¹¶æé†’äº‹ä»¶

## æ‘˜è¦

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ Telegram å’Œ Pythonï¼Œå±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªå…·æœ‰å¤šç§åŠŸèƒ½çš„å‹å¥½ Botï¼Œå®ƒå¯ä»¥ç”¨é—®ç­”å¯¹è¯èŠå¤©(çŸ­æœŸä¿¡æ¯)ï¼Œå¹¶å­˜å‚¨ç”¨æˆ·æ•°æ®ä»¥ä¾›å°†æ¥å›å¿†(é•¿æœŸä¿¡æ¯)ã€‚

![](img/988dedfea9a4cb3e9c72dc79f3b19c41.png)

èŠå¤©ç¤ºä¾‹(ä½œè€…å›¾ç‰‡)

è¿™ä¸€åˆ‡éƒ½æ˜¯å› ä¸ºæˆ‘çš„ä¸€ä¸ªæœ‹å‹å› ä¸ºæˆ‘ä¸è®°å¾—å¥¹çš„ç”Ÿæ—¥è€Œå¯¹æˆ‘å¤§å–Šå¤§å«ã€‚æˆ‘ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µã€‚æ‰€ä»¥æˆ‘æƒ³æˆ‘å¯ä»¥å‡è£…æˆ‘è®°å¾—ç”Ÿæ—¥ï¼Œè€Œå®é™…ä¸Šæˆ‘æœ‰ä¸€ä¸ªæœºå™¨äººä¸ºæˆ‘åšè¿™ä»¶äº‹ã€‚ç°åœ¨æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆäº†ï¼Œä¸ºä»€ä¹ˆè¦ä»å¤´å¼€å§‹æ„å»ºä¸€äº›ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å‘¨å›´æ•°ç™¾ä¸‡ä¸ªæ—¥å†åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªï¼Ÿä½ æ˜¯å¯¹çš„ï¼Œä½†æ˜¯å¯¹äºåƒæˆ‘ä»¬è¿™æ ·çš„ä¹¦å‘†å­æ¥è¯´â€¦é‚£æœ‰ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæˆ‘å°†ä»¥æˆ‘çš„çº¦ä¼šæé†’æœºå™¨äºº(ä»¥ä¸‹é“¾æ¥)ä¸ºä¾‹ï¼Œä¸€æ­¥æ­¥è®²è§£**å¦‚ä½•ç”¨ Python å’Œ MongoDB æ„å»ºæ™ºèƒ½ç”µæŠ¥æœºå™¨äººä»¥åŠå¦‚ä½•ç”¨ Heroku å’Œ Cron-Job å…è´¹éƒ¨ç½²**ã€ã€‚

[](https://t.me/DatesReminderBot) [## DatesReminderBot

### å¯ä»¥é©¬ä¸Šè”ç³»@DatesReminderBotã€‚

t.me](https://t.me/DatesReminderBot) 

æˆ‘å°†å±•ç¤ºä¸€äº›æœ‰ç”¨çš„ Python ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥å¾ˆå®¹æ˜“åœ°åº”ç”¨äºå…¶ä»–ç±»ä¼¼çš„æƒ…å†µ(åªéœ€å¤åˆ¶ã€ç²˜è´´ã€è¿è¡Œ)ï¼Œå¹¶é€šè¿‡æ³¨é‡Šéå†æ¯ä¸€è¡Œä»£ç ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å¤åˆ¶è¿™ä¸ªç¤ºä¾‹(ä¸‹é¢æ˜¯å®Œæ•´ä»£ç çš„é“¾æ¥)ã€‚

[](https://github.com/mdipietro09/Bot_TelegramDatesReminder) [## mdipietro 09/Bot _ TelegramDatesReminder

### GitHub æ˜¯è¶…è¿‡ 5000 ä¸‡å¼€å‘è€…çš„å®¶å›­ï¼Œä»–ä»¬ä¸€èµ·å·¥ä½œæ¥ç®¡ç†å’Œâ€¦

github.com](https://github.com/mdipietro09/Bot_TelegramDatesReminder) 

ç‰¹åˆ«æ˜¯ï¼Œæˆ‘å°†ç»å†:

*   è®¾ç½®:æ¶æ„æ¦‚è¿°ï¼Œæ–°*ç”µæŠ¥* Bot ç”Ÿæˆï¼Œ *MongoDB* è¿æ¥ï¼Œ *Python* ç¯å¢ƒã€‚
*   å‰ç«¯:ç¼–å†™ç”¨æˆ·ä¸ *pyTelegramBotAPI* äº¤äº’çš„æœºå™¨äººå‘½ä»¤ã€‚
*   åç«¯:ç”¨ *flask* å’Œ *threading* åˆ›å»ºæœåŠ¡å™¨ç«¯ appã€‚
*   é€šè¿‡ *Heroku* å’Œ *Cron-Job* éƒ¨ç½²æœºå™¨äºº

## è®¾ç½®

æˆ‘æƒ³ä»è¿™ä¸ªåº”ç”¨ç¨‹åºçš„æ€»ä½“æ¶æ„å¼€å§‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ¸…æ¥šåœ°çŸ¥é“è¿™ä¸ªçŸ­æš‚è€Œæœ‰è¶£çš„æ—…ç¨‹çš„æœ€ç»ˆç›®çš„åœ°ã€‚æˆ‘å°†æ„å»ºä¸€ä¸ª Python åº”ç”¨ç¨‹åºï¼Œéƒ¨ç½²åœ¨ [Heroku](https://www.heroku.com/) ä¸Šï¼Œé€šè¿‡[ç”µæŠ¥æœºå™¨äºº](https://telegram.org/blog/bot-revolution)ä¸ç”¨æˆ·äº¤äº’ï¼Œå°†ä¿¡æ¯å­˜å‚¨åˆ° [MongoDB](https://www.mongodb.com/) ä¸­ï¼Œå¹¶é€šè¿‡ [Cron-Job](https://cron-job.org/en/) å‘ç”¨æˆ·å‘é€é‡å¤æ¶ˆæ¯ã€‚

![](img/8905492d272444f1c336c2ed74940d75.png)

åº”ç”¨æ¶æ„(å›¾ç‰‡ç”±ä½œè€…æä¾›)

è¿™ä¸ªæ¶æ„å¯¹äºç½‘ç»œ/ç§»åŠ¨åº”ç”¨æ¥è¯´æ˜¯éå¸¸æ ‡å‡†çš„ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªé€‚å½“çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨ Telegram ä½œä¸ºå‰ç«¯ã€‚

åœ¨å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ Telegram ç”Ÿæˆ Bot å¹¶åˆ›å»º MongoDB å®ä¾‹ã€‚

Telegram å¯ä»¥è®©ä½ åœ¨ä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…**ç”Ÿæˆä¸€ä¸ªæ–°çš„æœºå™¨äºº**ï¼Œåªéœ€ç»™[æœºå™¨äººçˆ¶äº²](https://telegram.me/botfather)å‘ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åæŒ‰ç…§å®ƒçš„æŒ‡ç¤ºå»åšï¼Œå°±åƒè¿™æ ·:

![](img/a8a00d5ad9e7387d8dc1a688bb3e6772.png)![](img/705226647c6303a0fac229c8d017a857.png)![](img/77fbc26b0b8fdb29ccd6b43ed7de3606.png)

ä½œè€…å›¾ç‰‡

BotFather æä¾›äº†ä¸€ä¸ªç§˜å¯†çš„ API ä»¤ç‰Œï¼Œæˆ‘ä»¬ç¨åä¼šç”¨åˆ°å®ƒã€‚è‡³äºæˆ‘ä»¬çš„æœºå™¨äººå¯èƒ½çš„å‘½ä»¤ï¼Œæˆ‘å°†è®¾ç½®ä»¥ä¸‹é€‰é¡¹:

*   å¯åŠ¨åŠŸèƒ½(å½“ç”¨æˆ·å¯åŠ¨æœºå™¨äººæ—¶è¿è¡Œ)
*   ä¿å­˜å’Œåˆ é™¤äº‹ä»¶
*   æŸ¥çœ‹ä»Šå¤©çš„æ´»åŠ¨å¹¶æŸ¥çœ‹æˆ‘ä¿å­˜çš„æ‰€æœ‰æ´»åŠ¨
*   å¸®åŠ©åŠŸèƒ½

![](img/472c1aefbedce9be1f5dc3fb71600269.png)

ä½œè€…å›¾ç‰‡

è¿™å°†ä½¿æ‚¨èƒ½å¤Ÿåœ¨æœºå™¨äººå¯åŠ¨å¹¶è¿è¡Œæ—¶ï¼Œåœ¨ä¸æœºå™¨äººçš„èŠå¤©ä¸­å¯è§†åŒ–å¹¶é€‰æ‹©å‘½ä»¤:

![](img/8c2d7c3543120fd74babeadc9cd34722.png)

ä½œè€…å›¾ç‰‡

è®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œ **MongoDB è®¾ç½®**å¹¶æ³¨å†Œ/ç™»å½• [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) ï¼Œä¸€ä¸ªäº‘æ•°æ®åº“æœåŠ¡ã€‚ä»–ä»¬ç»™ä½ ä¸€ä¸ªæœ‰ 500 MB å­˜å‚¨ç©ºé—´çš„å…è´¹è´¦æˆ·(åˆ›å»ºé›†ç¾¤æ—¶é€‰æ‹© M0 æ²™ç›’é€‰é¡¹)ã€‚

![](img/2339b0566de3f1af6ad1fb1b9aa73523.png)

ä½œè€…å›¾ç‰‡

åœ¨â€œé›†åˆâ€ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ‚¨çš„æ•°æ®åº“å’Œé›†åˆ:

![](img/ebebe95ded67829d2d2a8db9551b7a67.png)![](img/18da7dfc413a5cb345ae304cfe320bca.png)

ä½œè€…å›¾ç‰‡

åœ¨â€œconnectâ€ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ‚¨çš„ç”¨æˆ·å¹¶è®¾ç½®æ‚¨çš„å¯†ç ï¼Œæ‚¨åº”è¯¥å°†å¯†ç æ”¾å…¥ä»–ä»¬æä¾›ç»™æ‚¨çš„å­—ç¬¦ä¸²ä¸­ï¼Œä»¥ä¾¿å°†æ‚¨çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ•°æ®åº“ã€‚ä¿å­˜å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬ä»¥åä¼šç”¨åˆ°å®ƒã€‚

![](img/d8c2fc3fe86821edd892daa7ab35e348.png)![](img/8e13113782f0126a37ea815ea84651b8.png)

ä½œè€…å›¾ç‰‡

ä¸ºäº†ç¼–å†™æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æˆ‘ä»¬çš„ **Python ç¯å¢ƒ**ã€‚æˆ‘å°†é€šè¿‡ç»ˆç«¯å®‰è£…ä»¥ä¸‹åº“:

```
pip install **pyTelegramBotAPI** pip install **pymongo** pip install **dnspython**
pip install **dateparser**
pip install **flask**
```

æˆ‘è®¤ä¸º [*pyTelegramBotAPI*](https://github.com/eternnoir/pyTelegramBotAPI) æ˜¯ Telegram APIs çš„æœ€ä½³ Python åº“ï¼Œå› ä¸ºå®ƒæä¾›äº†è½»æ¾æ„å»ºå¤æ‚èŠå¤©æœºå™¨äººçš„æ‰€æœ‰å·¥å…·ã€‚äººä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Telegram APIsï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰å¿…è¦é‡æ–°å‘æ˜è½®å­ã€‚ *pymongo* å’Œ *dnspython* åŒ…æ˜¯ç”¨ python è¿æ¥ MongoDB æ‰€å¿…éœ€çš„ã€‚ä¸ºäº†è®© Bot ç†è§£æ—¥æœŸï¼Œæˆ‘å°†ä½¿ç”¨[*date parser*](https://dateparser.readthedocs.io/en/latest/)*ã€‚*

å¦‚æœä½ æ­£åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å‡è®¾ä½ å·²ç»çŸ¥é“äº†[*flask*](https://flask.palletsprojects.com/en/1.1.x/)*(è¯·æ³¨æ„ï¼Œå¦‚æœä½ ä¸æ‰“ç®—éƒ¨ç½²ä½ çš„ botï¼Œä½ å°±ä¸éœ€è¦å®ƒ)ã€‚*

*ç°åœ¨éƒ½å‡†å¤‡å¥½äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚*

## *å‰ç«¯(ç”µæŠ¥æœºå™¨äºº)*

*æˆ‘ä»¬å¯ä»¥å¼€å§‹ç¼–å†™æœºå™¨äººäº†ã€‚é¦–å…ˆè°ƒç”¨ *pyTelegramBotAPI* å®ä¾‹ï¼Œæ’å…¥ BotFather æä¾›çš„ Telegram API TOKEN:*

```
*import **telebot**bot = **telebot**.TeleBot(**"insert the Telegram API TOKEN"**)*
```

*å…¶æ¬¡ï¼Œä½¿ç”¨ *pymongo* å’Œä» MongoDB Atlas è·å¾—çš„å­—ç¬¦ä¸²è¿æ¥åˆ°æ•°æ®åº“:*

```
*import **pymongo**client = **pymongo**.MongoClient(**"mongodb+srv://..."**)
db_name = "Telegram_DatesReminderBot"
collection_name = "users"
db = client[db_name][collection_name]*
```

*ç„¶åï¼Œæˆ‘å°†å®šä¹‰ä¸€ä¸ªç©ºå­—å…¸ï¼Œå…¶ä»»åŠ¡æ˜¯å­˜å‚¨ä¸´æ—¶ç”¨æˆ·ä¿¡æ¯(å¦‚ç”¨æˆ· id):*

```
*dic_user = {}*
```

*ç°åœ¨ï¼Œæˆ‘å°†æµè§ˆä¹‹å‰å®šä¹‰çš„**ä¸»å‘½ä»¤**(å¯åŠ¨ã€ä¿å­˜â€¦â€¦)å¹¶ä¸ºæœºå™¨äººç¼–å†™é€‚å½“çš„åŠ¨ä½œã€‚è®©æˆ‘ä»¬ä»â€œ */start* â€å¼€å§‹ï¼Œè¿™æ˜¯å½“ä½ ç¬¬ä¸€æ¬¡å¼€å§‹ä¸æœºå™¨äººèŠå¤©æ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‘½ä»¤ã€‚æˆ‘å°†è®©æœºå™¨äººä»¥ä¸€æ¡æ¬¢è¿æ¶ˆæ¯å’Œä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆçš„å»ºè®®å¼€å§‹:*

*![](img/ec42bf715ce6fa7ce9e22076ac78e8de.png)*

*ä½œè€…å›¾ç‰‡*

```
***@bot.message_handler(commands=['start'])**
def **_start**(message):
    msg = "Hello "+str(message.chat.username)+\
          ", I'm a date reminder. Tell me birthdays and events to remind you. To learn how to use me, use \n/help"
    bot.send_message(message.chat.id, msg)*
```

*æœ‰æ²¡æœ‰ä½ è®¤ä¸å‡ºæ¥çš„ç»†èŠ‚ï¼Ÿè®©æˆ‘æ¥å¸®ä½ :*

*![](img/1ad97491d388c8633925844c9f096a7f.png)*

*ç®€å•å¯¹å—ï¼Ÿä½†é‚£åªæ˜¯çƒ­èº«ã€‚ç°åœ¨â€œ */save* â€å‘½ä»¤å°†å˜å¾—æ›´åŠ æ£˜æ‰‹ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°ä¸€ä¸ªé—®ç­”å¯¹è¯:*

*![](img/335e091c3eec23fbd960a9b23fee9825.png)*

*ä½œè€…å›¾ç‰‡*

```
***@bot.message_handler(commands=['save'])**
def **_save**(message):
    msg = "Set an event in the format 'month dd', for example: \n\
            xmas day: Dec 25 \n\
I also understand: \n\
today, tomorrow, in 3 days, in 1 week, in 6 months, yesterday, 3 days ago ... so you can do: \n\
            meeting: tomorrow"
    message = bot.reply_to(message, msg)
    bot.register_next_step_handler(message, **save_event**)*
```

*å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆ‘ç”¨äº† *bot.reply_to()* è€Œä¸æ˜¯ *bot.send_message()ã€‚*åè€…å‘é€ä¸€èˆ¬çš„èŠå¤©æ¶ˆæ¯ï¼Œå‰è€…å‘é€å“åº”ç‰¹å®šè¾“å…¥çš„æ¶ˆæ¯ã€‚æˆ‘ä½¿ç”¨å®ƒæ˜¯å› ä¸ºè¿™æ˜¯ç”¨æˆ·å’Œæœºå™¨äººä¹‹é—´çš„çœŸå®å¯¹è¯:ç”¨æˆ·è¯·æ±‚ä¿å­˜ä¿¡æ¯ï¼Œæœºå™¨äººå›å¤å¹¶ç­‰å¾…ç”¨æˆ·å“åº”ã€‚æ¥è‡ªç”¨æˆ·çš„æ–°æ¶ˆæ¯å°†ç”±*bot . register _ next _ step _ handler()*å¤„ç†ï¼Œä½œä¸º *save_event()* å‡½æ•°çš„è¾“å…¥ï¼Œæˆ‘ä»¬ç°åœ¨å°†å®šä¹‰è¯¥å‡½æ•°ï¼Œç„¶åè¿›è¡Œç¼–ç ã€‚*

*æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘æƒ³æŒ½æ•‘æˆ‘å¦ˆå¦ˆçš„ç”Ÿæ—¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘è¾“å…¥â€œ *mum: Oct 15* â€ã€‚æœºå™¨äººå¿…é¡»è¯†åˆ«äº‹ä»¶çš„åç§°ï¼Œæ–‡æœ¬ä¸­çš„â€œ*å¦ˆå¦ˆ*å’Œæ—¥æœŸâ€œ*10 æœˆ 15 æ—¥*â€ã€‚ä¹‹åï¼Œå¿…é¡»å­˜å‚¨ä¿¡æ¯ï¼Œè€ƒè™‘è¿”å›ç”¨æˆ·(å·²ç»åœ¨æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´æ–°ç”¨æˆ·çš„äº‹ä»¶)å’Œæ–°ç”¨æˆ·(å¿…é¡»æ·»åŠ åˆ°æ•°æ®åº“ä¸­)ä¸¤ç§æƒ…å†µã€‚*

*ç”¨ Python çš„æœ¯è¯­æ¥è¯´:*

```
*import **dateparser**def **save_event**(message):
    dic_user["id"] = str(message.chat.id) **## get text**
    txt = message.text
    name= txt.split(":")[0].strip() 
    date = txt.split(":")[1].strip() **## check date**
    date = **dateparser**.parse(date).strftime('%b %d') **## save**
    lst_users = db.distinct(key="id")
    if dic_user["id"] not in lst_users:
        db.insert_one({"id":dic_user["id"], "events":{name:date}})
    else:
        dic_events = db.find_one({"id":dic_user["id"]})["events"]
        dic_events.update({name:date})
        db.update_one({"id":dic_user["id"]}, {"$set":
                      {"events":dic_events}})

    **## send done**
    msg = name+": "+date+" saved."
    bot.send_message(message.chat.id, msg)*
```

*æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨äº† *dateparser* æ¥è¯†åˆ«äººç±»å¯è¯»çš„æ—¥æœŸã€‚è¿™å…è®¸ç”¨æˆ·ä»¥ä¸åŒçš„æ ¼å¼ä¹¦å†™æ—¥æœŸ:*

*![](img/b90a261f421c910a183234e70715bea2.png)*

*ä½œè€…å›¾ç‰‡*

*ç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥æ„å»ºå…¶ä»–å‡½æ•°æ¥æ£€æŸ¥å’Œåˆ é™¤ db ä¸­çš„äº‹ä»¶(æˆ‘å°†åœ¨æ–‡ç« æœ«å°¾æä¾›å®Œæ•´çš„ä»£ç ï¼Œæˆ–è€…æ‚¨å¯ä»¥æŸ¥çœ‹æœ¬æ•™ç¨‹å¼€å¤´çš„ GitHub é“¾æ¥)ã€‚*

*å¦‚æœç”¨æˆ·å‘é€ä¸€äº›**éšæœºæ–‡æœ¬**æ²¡æœ‰é“¾æ¥åˆ°ä»»ä½•ç‰¹å®šå‘½ä»¤ä¼šæ€æ ·ï¼Ÿå¦‚æœæˆ‘ä»¬ä¸åŒ…æ‹¬è¿™ç§äº‹ä»¶ï¼Œæœºå™¨äººå°†ä»€ä¹ˆä¹Ÿä¸åšã€‚å› æ­¤ï¼Œæˆ‘é¢„è®¡æœºå™¨äººåº”è¯¥æ­£ç¡®å“åº”çš„ä¸¤ç§æƒ…å†µ(é—®å€™å’Œæ„Ÿè°¢æ¶ˆæ¯)ä»¥åŠæœºå™¨äººç”¨æ ‡å‡†æ¶ˆæ¯å›ç­”çš„æ‰€æœ‰å…¶ä»–æƒ…å†µã€‚*

*![](img/5eee610706e1fbdf3b5d92e27d3df81d.png)*

*ä½œè€…å›¾ç‰‡*

```
***@bot.message_handler(func=lambda m: True)**
def **chat**(message):
    txt = message.text
    if any(x in txt.lower() for x in [**"thank","thx","cool"**]):
        msg = "anytime"
    elif any(x in txt.lower() for x in [**"hi","hello","yo","hey"**]):
        msg = "yo" if str(message.chat.username) == "none" else 
              "yo "+str(message.chat.username)
    else:
        msg = "save a date with \n/save"
    bot.send_message(message.chat.id, msg)*
```

*æˆ‘ä¿æŒè¿™éƒ¨åˆ†ç›¸å½“åŸºç¡€ï¼Œå› ä¸ºå®ƒä¸æ˜¯æœ¬æ•™ç¨‹çš„ä¸»è¦ç„¦ç‚¹ï¼Œä½†æ˜¯äººä»¬å¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„ NLP æŠ€æœ¯æ¥ä½¿èŠå¤©æœºå™¨äººæ›´åŠ æ™ºèƒ½å’Œå¥è°ˆã€‚*

*è¯è™½å¦‚æ­¤ï¼Œæˆ‘ä»¬çš„æœºå™¨äººå·²ç»è¶³å¤Ÿç†Ÿç»ƒï¼Œå¯ä»¥**è¿è¡Œå’Œæµ‹è¯•**ã€‚æ‚¨å¯ä»¥åœ¨ä»£ç çš„æœ«å°¾æ·»åŠ ä¸‹é¢ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œæ•´ä¸ªè„šæœ¬ã€‚*

```
*bot.infinity_polling(True)*
```

*ç°åœ¨ï¼Œæ‚¨çš„æœºå™¨äººå·²ç»å¯åŠ¨å¹¶è¿è¡Œï¼Œç”±æ‚¨çš„ç¬”è®°æœ¬ç”µè„‘æ‰˜ç®¡ã€‚ä½ å¯ä»¥åœ¨ç”µæŠ¥ä¸Šç©å®ƒã€‚å¦‚æœæ‚¨ä¸æ‰“ç®—éƒ¨ç½²æ‚¨çš„ botï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œåœä¸‹æ¥ï¼Œå› ä¸ºæœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†è§£é‡Šäº†éƒ¨ç½²çš„æ­¥éª¤ã€‚*

## *åç«¯(çƒ§ç“¶åº”ç”¨ç¨‹åº)*

*æˆ‘ä»¬å°†é¦–å…ˆåœ¨ [Heroku](https://www.heroku.com/) **ï¼Œ**äº‘å¹³å°å³æœåŠ¡ä¸Šåˆ›å»ºä¸€ä¸ª**æ–°çš„åº”ç”¨ç¨‹åºé¡¹ç›®**ï¼Œè¯¥é¡¹ç›®åªéœ€ä¸€ä¸ªå…è´¹å¸æˆ·å³å¯éƒ¨ç½² PoC åº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥é“¾æ¥æ‚¨çš„ GitHub é¡¹ç›®å¹¶éƒ¨ç½²å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ã€‚*

*![](img/5a8d89ef86f6a1b3ec68ad98d35e325d.png)**![](img/b70198a35658eca5892172262997f8b0.png)*

*ä½œè€…å›¾ç‰‡*

*ç›®å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬åªéœ€è¦ Heroku ç”Ÿæˆçš„ app ç½‘å€ã€‚ä¿å­˜å®ƒï¼›ä½ å¾ˆå¿«å°±ä¼šéœ€è¦å®ƒã€‚*

*![](img/bb33057b5df770d36e21a618443dca2b.png)*

*ä½œè€…å›¾ç‰‡*

*è®©æˆ‘ä»¬å›åˆ°ç¼–ç ä¸Šæ¥ï¼Œä»æ·»åŠ ä¸€ä¸ªæ–°çš„å¸¦æœ‰ *flask* çš„æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºåˆ°æˆ‘ä»¬å·²ç»ç¼–è¾‘è¿‡çš„ Python è„šæœ¬ *:* å¼€å§‹*

```
*import **flask**server = **flask**.Flask(__name__)*
```

*æˆ‘ä»¬å¿…é¡»**è®¾ç½®ä¸€ä¸ª webhook** ï¼Œè¿™æ˜¯ web å¼€å‘ä¸­ç”¨äºå°†å®æ—¶ä¿¡æ¯ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºä¼ é€’åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å¸¸ç”¨æ–¹æ³•ã€‚å¤šäºäº† webhookï¼ŒTelegram Bot å°†å®æ—¶æ•°æ®æ¨é€åˆ° Heroku åº”ç”¨ç¨‹åºã€‚*

```
***@server.route('/Telegram API TOKEN', methods=['POST'])** def **getMessage**():
   bot.process_new_updates([**telebot**.types.Update.de_json(
      **flask**.request.stream.read().decode("utf-8"))])
   return "!", 200**@server.route("/")** def **webhook**():
   bot.remove_webhook()
   bot.set_webhook(url=**'Heroku App Web Address /'**
                      +**'Telegram API TOKEN'**)
   return "!", 200*
```

*æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çš„ Bot å‡ ä¹ä»€ä¹ˆéƒ½æœ‰äº†ï¼Œå®ƒè¿˜éœ€è¦æœ€åä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½:**æé†’**ã€‚å®ƒèŠå¤©å¹¶ä¿å­˜ä¿¡æ¯ï¼Œä½†è¿™æ¬¾åº”ç”¨çš„ä¸»è¦ç›®çš„æ˜¯è‡ªåŠ¨å‘é€è­¦æŠ¥ã€‚å› æ­¤ï¼Œæˆ‘å°†æ„å»ºä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œå®ƒä¼šåœ¨æ¯æ¬¡è¿è¡Œæ—¶æ£€æŸ¥ä»Šå¤©çš„äº‹ä»¶å¹¶å‘é€äº‹ä»¶æé†’ã€‚*

```
*import **datetime**def **scheduler**():
    lst_users = db.distinct(key="id")
    for user in lst_users:
        dic_events = db.find_one({"id":user})["events"]
        today = **datetime**.datetime.today().strftime('%b %d')
        res = [k for k,v in dic_events.items() if v == today]
        if len(res) > 0:
            msg = "Today's events: "+", ".join(res)
            bot.send_message(user, msg)*
```

*å½“åº”ç”¨ç¨‹åºè¢«æ‰§è¡Œæ—¶ï¼Œè¿™ä¸ªè°ƒåº¦ç¨‹åºå°†åœ¨ä¸åŒäºä¸»*çƒ§ç“¶*åº”ç”¨ç¨‹åºçš„çº¿ç¨‹ä¸Šè¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºå°†åŒæ—¶å‘ç”Ÿä¸¤ä»¶äº‹:èŠå¤©æœºå™¨äººåŠŸèƒ½å’Œæ—¥ç¨‹æé†’ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸¤ä¸ªä¸»è¦åŠ¨ä½œæ”¾åœ¨è„šæœ¬çš„æœ«å°¾ï¼Œå½“å…¨éƒ¨ä»£ç æ‰§è¡Œæ—¶ï¼Œå®ƒä»¬ä¼šè®©ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚*

```
*import **threading**
import **os**if __name__ == "__main__":
   **threading**.Thread(target=scheduler).start()
   server.run(host="0.0.0.0", 
              port=int(**os**.environ.get("PORT", 5000)))*
```

## *éƒ¨ç½²*

*æœ€åï¼Œæ˜¯æ—¶å€™éƒ¨ç½²åº”ç”¨ç¨‹åºäº†ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å°†å±•ç¤ºæˆ‘çš„å­˜å‚¨åº“çš„**ç»“æ„:***

*![](img/94fd86c09361c112b5ea1d8ccc302879.png)*

*ä½œè€…å›¾ç‰‡*

*æ‚¨ä¸å¿…ä¿æŒç›¸åŒçš„å›è´­ç»“æ„ï¼Œä½†æ˜¯æ‚¨è‚¯å®šéœ€è¦ Heroku éœ€è¦çš„ä¸¤ä¸ªæ–‡ä»¶:requirements.txtï¼Œæ‚¨å¯ä»¥ä»ç»ˆç«¯åˆ›å»º*

```
*pip freeze > requirements.txt*
```

*å’Œ *Procfile* (æ²¡æœ‰æ‰©å±•å)ï¼ŒåŒ…å«éƒ¨ç½²åè¦æ‰§è¡Œçš„å‘½ä»¤*

```
*web: python telegram_bot.py*
```

*å…³äº**ç”µæŠ¥å’Œ MongoDB å¯†é’¥**ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ä½œä¸ºé…ç½®å˜é‡æ”¾åœ¨ Heroku ä¸Š(æˆ‘å°†å®ƒä»¬å‘½åä¸ºâ€œ *telegram_key* â€å’Œâ€œ *mongodb_key* â€):*

*![](img/fb1191512446defb4491484513b03a01.png)**![](img/1e0f1d989752df0e28c8345639c213bf.png)*

*ä½œè€…å›¾ç‰‡*

*å½“åº”ç”¨ç¨‹åºåœ¨ Heroku ä¸Šè¿è¡Œæ—¶ï¼Œæˆ‘çš„*è®¾ç½®*æ–‡ä»¶å¤¹ä¸­çš„ *config.py* æ–‡ä»¶è´Ÿè´£æ£€ç´¢å’Œä½¿ç”¨å¯†é’¥ã€‚ä»¥ä¸‹æ˜¯ *config.py:* ä¸­çš„å®Œæ•´ä»£ç *

```
*import **os****ENV = "PROD"**  **#<--- change here DEV or PROD****## keys**
**if ENV == "DEV":**
 **from settings import keys**
 telegram_key = **keys**.telegram_key
 mongodb_key = **keys**.mongodb_key**elif ENV == "PROD":**
 import **ast**
 telegram_key = **ast**.literal_eval(**os**.environ["telegram_key"])
 mongodb_key = **ast**.literal_eval(**os**.environ["mongodb_key"])**## server**
host = "0.0.0.0"
port = int(**os**.environ.get("PORT", 5000))*
```

*è¿™é‡Œæ˜¯ *telegram_bot.py* ä¸­çš„**å®Œæ•´ä»£ç **ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æ•´ä¸ªæ•™ç¨‹ä¸­ä¸€ç›´åœ¨åšçš„æœºå™¨äººå’Œåº”ç”¨ç¨‹åºçš„ä¸»è„šæœ¬:*

*é…·ï¼Œè®©æˆ‘ä»¬**éƒ¨ç½²**è¿™ä¸ªåå°å­ä¸Š Heroku:*

*![](img/e2960ceb9c0a30c7e5be88611ea551e9.png)**![](img/522f2c85f906c1b1eb01a655229df7e2.png)*

*ä½œè€…å›¾ç‰‡*

*ç°åœ¨ï¼Œæ‚¨åº”è¯¥å·²ç»å®‰è£…å¹¶è¿è¡Œäº† Heroku web åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ Telegram ä¸Šä½¿ç”¨è¯¥æœºå™¨äººã€‚è¯•è¯•å§ï¼*

*æœ€åï¼Œæˆ‘å°†**è®¾ç½®ä¸€ä¸ª**[**Cron-Job**](https://cron-job.org/en/)æ¥ ping Heroku web åœ°å€ã€‚è¿™å°†ä½¿é¡µé¢é‡æ–°åŠ è½½ï¼Œåº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨ï¼Œé¢„å®šæé†’å°†åœ¨å…¶çº¿ç¨‹ä¸Šè¿è¡Œã€‚*

*![](img/89287599bf511dbc12d84d49ef2c3704.png)**![](img/8cdb50a1b4235d3736cda3e869d80543.png)*

*ä½œè€…å›¾ç‰‡*

*æ‰€ä»¥æ˜å¤©ï¼Œå½“æˆ‘ä»¬é†’æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€æ¡å…³äºä»Šå¤©å‘ç”Ÿçš„äº‹æƒ…çš„æ¶ˆæ¯ã€‚*

*![](img/9c7cf21e07bccf5348ac87974d85914d.png)**![](img/a6be8779a0530f025ef778b84c75c706.png)*

*ä½œè€…å›¾ç‰‡*

## *ç»“è®º*

*æœ¬æ–‡æ˜¯ä¸€ä¸ªæ•™ç¨‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ç”¨ Python æ„å»ºä¸€ä¸ªæ¼‚äº®çš„ç”µæŠ¥æœºå™¨äººï¼Œå®ƒå°†ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ MongoDB ä¸­ï¼Œå¹¶é€šè¿‡ Cron-Job æ£€ç´¢ä¿¡æ¯ã€‚ç°åœ¨ä½ çŸ¥é“å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„äº†ï¼Œä½ å¯ä»¥å¼€å‘ä½ è‡ªå·±çš„èŠå¤©æœºå™¨äººæ¥ç©ã€‚*

*æˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼å¦‚æœ‰é—®é¢˜å’Œåé¦ˆï¼Œæˆ–è€…åªæ˜¯åˆ†äº«æ‚¨æ„Ÿå…´è¶£çš„é¡¹ç›®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ã€‚*

> *ğŸ‘‰[æˆ‘ä»¬æ¥è¿çº¿](https://linktr.ee/maurodp)ğŸ‘ˆ*

> *æœ¬æ–‡æ˜¯ä½¿ç”¨ Python å¼€å‘**åº”ç”¨ç¨‹åºç³»åˆ—çš„ä¸€éƒ¨åˆ†ï¼Œå¦è¯·å‚è§:***

*[](https://towardsdatascience.com/web-development-with-python-dash-complete-tutorial-6716186e09b3) [## ç”¨ Python è¿›è¡Œ Web å¼€å‘:Dash(å®Œæ•´æ•™ç¨‹)

### ç”¨ Plotly ç»˜å›¾ï¼ŒåµŒå…¥å¼•å¯¼ CSSï¼Œä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ï¼Œé€‰æ‹©åæ”¹å˜è¾“å…¥ï¼Œå¯¼èˆªæ¡ï¼Œå¾®è°ƒå™¨ï¼Œå’Œâ€¦

towardsdatascience.com](https://towardsdatascience.com/web-development-with-python-dash-complete-tutorial-6716186e09b3) [](https://towardsdatascience.com/how-to-embed-bootstrap-css-js-in-your-python-dash-app-8d95fc9e599e) [## å¦‚ä½•åœ¨ä½ çš„ Python Dash åº”ç”¨ä¸­åµŒå…¥å¼•å¯¼ CSS & JS

### ä½¿ç”¨ Dash Bootstrap ç»„ä»¶æ„å»ºæ–°å† è‚ºç‚æ„ŸæŸ“é¢„æµ‹åº”ç”¨ç¨‹åº

towardsdatascience.com](https://towardsdatascience.com/how-to-embed-bootstrap-css-js-in-your-python-dash-app-8d95fc9e599e) [](https://towardsdatascience.com/surpass-excel-vlookup-with-python-and-nlp-ab20d56c4a1a) [## å­—ç¬¦ä¸²åŒ¹é…:ç”¨ Python å’Œ NLP è¶…è¶Š Excel VLOOKUP

### ä¸ºæ‰€æœ‰ Excel çˆ±å¥½è€…(å’Œè®¨åŒè€…)æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…åº”ç”¨ç¨‹åº

towardsdatascience.com](https://towardsdatascience.com/surpass-excel-vlookup-with-python-and-nlp-ab20d56c4a1a)*