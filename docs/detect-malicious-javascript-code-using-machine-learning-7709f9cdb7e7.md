# ä½¿ç”¨æœºå™¨å­¦ä¹ æ£€æµ‹æ¶æ„ JavaScript ä»£ç 

> åŸæ–‡ï¼š<https://pub.towardsai.net/detect-malicious-javascript-code-using-machine-learning-7709f9cdb7e7?source=collection_archive---------1----------------------->

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥æ£€æµ‹æ··æ·†çš„ JavaScript ä»£ç ç‰‡æ®µçš„æ–¹æ³•ã€‚

![](img/ed4e00e05d7b6a5dec0d84d7016f3db7.png)

åŠ å¸ƒé‡ŒåŸƒå°”Â·æµ·å› ç­–åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

## ä»‹ç»

M ost ç½‘ç«™ä½¿ç”¨ JavaScript (JS)ä»£ç åˆ¶ä½œåŠ¨æ€å†…å®¹ï¼›å› æ­¤ï¼ŒJS ä»£ç æˆä¸ºé’ˆå¯¹æµè§ˆå™¨ã€æµè§ˆå™¨æ’ä»¶ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯å’Œå…¶ä»– JS åº”ç”¨ç¨‹åºçš„æœ‰ä»·å€¼çš„æ”»å‡»åª’ä»‹ã€‚å¸¸è§çš„åŸºäº JS çš„æ”»å‡»åŒ…æ‹¬ä¸‹è½½é©±åŠ¨ã€è·¨ç«™è„šæœ¬(XSS)ã€è·¨ç«™è¯·æ±‚ä¼ªé€ (XSRF)ã€æ¶æ„å¹¿å‘Šç­‰ã€‚å¤§å¤šæ•°æ¶æ„çš„ JS ä»£ç è¢«æ··æ·†ï¼Œä»¥ä¾¿éšè—å®ƒä»¬æ­£åœ¨åšçš„äº‹æƒ…ï¼Œå¹¶é¿å…è¢«åŸºäºç­¾åçš„å®‰å…¨ç³»ç»Ÿæ£€æµ‹åˆ°ã€‚æ¢å¥è¯è¯´ï¼Œæ··æ·†æŠ€æœ¯æ˜¯ä¸€ç³»åˆ—æ··æ·†çš„ä»£ç è½¬æ¢ï¼Œä»¥æŸå®³å…¶å¯ç†è§£æ€§ï¼Œä½†åŒæ—¶ä¿å­˜å…¶åŠŸèƒ½ã€‚

![](img/1697255e2d647dcae0292f9cb1102684.png)

éšæœºåŒ–æ··æ·†çš„ç¤ºä¾‹

ä¼ ç»Ÿçš„åç—…æ¯’å’Œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿ(IDS)é‡‡ç”¨åŸºäºå¯å‘å¼å’ŒåŸºäºç­¾åçš„æ–¹æ³•æ¥æ£€æµ‹æ¶æ„ JS ä»£ç ã€‚ä½†æ˜¯åœ¨é›¶æ—¥æ”»å‡»çš„æƒ…å†µä¸‹ï¼Œè¿™ç§åˆ†æå¯èƒ½æ˜¯ä½æ•ˆçš„ã€‚ç›®å‰æ­£åœ¨å„ä¸ªè¡Œä¸šç§¯æå¼€å‘çš„æœºå™¨å­¦ä¹ (ML)åº”ç”¨ä¹Ÿåœ¨ç½‘ç»œå®‰å…¨ä¸­æ‰¾åˆ°äº†è‡ªå·±çš„ä½ç½®ã€‚ML å·²ç»è¯æ˜äº†å®ƒå¯¹é›¶åŸºæ”»å‡»çš„æœ‰æ•ˆæ€§ã€‚å½“æ¶‰åŠåˆ°æ£€æµ‹æ¶æ„ JS ä»£ç æ—¶ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä»è‡ªç„¶è¯­è¨€å¤„ç†(NLP)é¢†åŸŸï¼Œä½¿ç”¨è¡¨æ ¼æ•°æ®çš„æ ‡å‡† MLï¼Œåˆ°æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚

ML æ¨¡å‹çš„è¾“å…¥æ•°æ®ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ†æç¨‹åºçš„è¡Œä¸º:é™æ€å’ŒåŠ¨æ€ä»£ç åˆ†æã€‚é™æ€æ–¹æ³•åœ¨ä¸è¿è¡Œæºä»£ç çš„æƒ…å†µä¸‹åˆ†ææ•°æ®ï¼Œå¹¶ä¸”åªåŸºäºæºä»£ç ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ä»¥é€šè¿‡éå†ä»£ç æŠ½è±¡è¯­æ³•æ ‘æ¥å­˜æ¡£ã€‚ç›¸åï¼ŒåŠ¨æ€ä»£ç åˆ†æéœ€è¦æ‰§è¡Œæºä»£ç ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åªè€ƒè™‘é™æ€åˆ†æçš„æƒ…å†µã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹ä¸€äº›ç›¸å…³çš„å·¥ä½œï¼Œä»¥äº†è§£ç ”ç©¶äººå‘˜ä¸ºæ··æ·†çš„ JS ä»£ç æ£€æµ‹æä¾›äº†ä»€ä¹ˆã€‚è¿˜å°†è€ƒè™‘ä½¿ç”¨ NLP ç‰¹æ€§å’Œæ ‡å‡† ML æ–¹æ³•çš„ç»„åˆæ¥åˆ†ç±»è‰¯æ€§/æ¶æ„ JS ä»£ç ç‰‡æ®µçš„ä»»åŠ¡ã€‚

## ç›¸å…³è‘—ä½œ

åœ¨â€œ[ä½¿ç”¨æœºå™¨å­¦ä¹ æ£€æµ‹æ··æ·†çš„ JavaScript](https://www.researchgate.net/publication/321805699_Detecting_Obfuscated_JavaScripts_using_Machine_Learning)ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†æ¥è‡ªå†…å®¹äº¤ä»˜ç½‘ç»œ jsDelivrã€Alexa 500 å¼ºç½‘ç«™çš„å¸¸è§„ã€è¿·ä½ å’Œæ··æ·†æ ·æœ¬æ•°æ®é›†ï¼Œä»¥åŠæ¥è‡ªç‘å£«ä¿¡æ¯ä¿éšœæŠ¥å‘Šå’Œåˆ†æä¸­å¿ƒ [MELANI](https://www.ncsc.admin.ch/ncsc/en/home.html) çš„ä¸€ç»„æ¶æ„ JavaScript æ ·æœ¬ã€‚ä½œè€…è¡¨æ˜ï¼ŒåŒºåˆ†æ··æ·†å’Œéæ··æ·†è„šæœ¬æ˜¯å¯èƒ½çš„ï¼Œç²¾ç¡®åº¦å’Œå¬å›ç‡çº¦ä¸º 99%ã€‚ä½¿ç”¨äº†ä»¥ä¸‹ä¸€ç»„åŠŸèƒ½:

![](img/ccc961d8b8302931de9eb8840696daad.png)

JavaScript ç‰‡æ®µçš„é™æ€ç‰¹æ€§ï¼Œæ¥æº:[ä½¿ç”¨æœºå™¨å­¦ä¹ æ£€æµ‹æ··æ·†çš„ JavaScript](https://www.researchgate.net/publication/321805699_Detecting_Obfuscated_JavaScripts_using_Machine_Learning)

æå–çš„ç‰¹å¾å‘é‡é›†ç”¨äºè®­ç»ƒå’Œè¯„ä¼°ä¸‰ç§ä¸åŒçš„åˆ†ç±»å™¨:çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)ã€éšæœºæ£®æ—(RF)å’Œæ”¯æŒå‘é‡æœº(SVM)ã€‚

åœ¨â€œ[ä½¿ç”¨ AST ç‰¹å¾å’Œæ®µè½å‘é‡æ£€æµ‹åŸºäº JavaScript çš„æ”»å‡»çš„æœºå™¨å­¦ä¹ æ–¹æ³•](https://www.sciencedirect.com/science/article/pii/S1568494619305022)ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†å¦ä¸€ç§æ–¹æ³•ä» JS ä»£ç ä¸­æå–ç‰¹å¾ã€‚ä»–ä»¬é‡‡ç”¨[æŠ½è±¡è¯­æ³•æ ‘(AST)](https://en.wikipedia.org/wiki/Abstract_syntax_tree) ä½œä¸ºä»£ç ç»“æ„è¡¨ç¤ºï¼Œå¹¶å°†å…¶ç”¨ä½œ Doc2Vec æ–¹æ³•çš„è¾“å…¥ã€‚æ¶æ„ JS ä»£ç çš„é©±åŠ¨ä¸‹è½½æ•°æ®å’Œè‰¯æ€§ JS ä»£ç çš„ JS unpack plus Alexa 100 å¼ºç½‘ç«™æ•°æ®é›†è¢«ç”¨ä½œè®­ç»ƒæ•°æ®é›†ã€‚ä¸ºäº†æ„å»º ASTï¼Œä½œè€…ä½¿ç”¨äº†ä¸€ä¸ªè¯­æ³•å’Œè¯æ±‡åˆ†æå·¥å…· [Esprima](https://esprima.org/demo/parse.html#) ã€‚

è™½ç„¶ä»¥å‰çš„æ–¹æ³•ä¾èµ–äºè¯æ³•å’Œè¯­æ³•ç‰¹å¾ï¼Œä½†â€œ[åŸºäºåŒå‘ LSTM æ¨¡å‹çš„æ¶æ„ JavaScript æ£€æµ‹](https://www.mdpi.com/2076-3417/10/10/3440)ä¸­è€ƒè™‘çš„æ–¹æ³•åˆ©ç”¨äº†è¯­ä¹‰ä¿¡æ¯ã€‚é™¤äº† AST ç‰¹æ€§ï¼Œä½œè€…è¿˜æ„å»ºäº†ç¨‹åºä¾èµ–å›¾(PDG ),å¹¶ç”Ÿæˆäº† JS ä»£ç è¯­ä¹‰ç‰‡ï¼Œè¿™äº›è¯­ä¹‰ç‰‡è¢«è½¬æ¢æˆæ•°å­—å‘é‡ã€‚ç„¶åå°†è¿™äº›å‘é‡è¾“å…¥åŒå‘é•¿çŸ­æœŸè®°å¿†ç¥ç»ç½‘ç»œã€‚BLSTM æ¨¡å‹è¡¨ç°å‡º 97.71%çš„å‡†ç¡®ç‡å’Œ 98.29%çš„ F1 å€¼ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨é™æ€åˆ†æçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç¡®å®š JS ä»£ç çš„å‡ ç§å¸¸è§**æ–¹æ³•:**

*   æ–¹æ³• 1(è‡ªç„¶è¯­è¨€):å°† JS ä»£ç è§†ä¸ºè‡ªç„¶è¯­è¨€æ–‡æœ¬ã€‚ç‰¹å¾å¯ä»¥è¡¨ç¤ºä¸ºå­—ç¬¦ç»Ÿè®¡ã€æ–‡ä»¶ç†µã€ç‰¹æ®ŠåŠŸèƒ½è®¡æ•°ã€ç‰¹æ®Šç¬¦å·æ•°é‡ç­‰çš„é›†åˆã€‚
*   æ–¹æ³• 2(è¯æ³•ç‰¹æ€§):æå–æ™®é€š JS æ–‡æœ¬å…ƒç´ çš„æ­£åˆ™è¡¨è¾¾å¼(å¦‚[a-z]+å¹¶åˆ é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚âˆ«ã€=ã€ï¼ç­‰ã€‚)ä¸ NLP ç‰¹å¾åŒ–æ–¹æ³•åº”ç”¨ç›¸ç»“åˆï¼Œå¦‚è¯è¢‹(BOW)ã€TF-IDFã€Doc2Vecã€LDAã€åµŒå…¥ç­‰ã€‚
*   æ–¹æ³• 3(å¥æ³•ç‰¹å¾):AST ç‰¹å¾åŠ  NLP ç‰¹å¾åŒ–ï¼›
*   æ–¹æ³• 4(è¯­ä¹‰ç‰¹å¾):è·å– AST ç‰¹å¾->æ„å»ºæ§åˆ¶æµå›¾(CFG) ->æ„å»ºç¨‹åºä¾èµ–å›¾(PDG) ->è·å–è¯­ä¹‰åˆ‡ç‰‡->è½¬æ¢ä¸ºæ•°å­—å‘é‡ã€‚

## ç¼–ç éƒ¨åˆ†:**è‰¯æ€§/æ¶æ„ JS ä»£ç çš„åˆ†ç±»**

**å‡ºäºè¿™ä¸ªç›®çš„ï¼Œè®©æˆ‘ä»¬ä¸ºç½‘ç»œå®‰å…¨é£Ÿè°±ä½¿ç”¨æ¥è‡ª[æœºå™¨å­¦ä¹ çš„æ•°æ®é›†ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å°†ä½¿ç”¨ä¸Šé¢æåˆ°çš„æ–¹æ³• 1ã€‚](https://github.com/PacktPublishing/Machine-Learning-for-Cybersecurity-Cookbook/tree/master/Chapter03/Detecting%20Obfuscated%20Javascript)**

****æ•°æ®ä¸‹è½½****

**![](img/d130340db758bb86c8e102521ce40192.png)**

****æ•°æ®æ¸…ç†****

**0 æ ‡ç­¾â€”æ­£å¸¸ä»£ç ï¼Œ1 æ ‡ç­¾â€”æ··æ·†ä»£ç **

**![](img/e95621b67138de4b9d0f2c0a1eca60bf.png)****![](img/028c7401ef89322d54d43abb83a7d585.png)**

****ç‰¹å¾å·¥ç¨‹****

**![](img/9747e4d229a3a5967919428501945397.png)****![](img/2c21eebf7e8e77421a06f925485b6891.png)**

**å¯¹äºå…¶ä»–ç‰¹æ€§ï¼Œæˆ‘ä½¿ç”¨äº†ä¸‹é¢çš„ JS å‡½æ•°åˆ—è¡¨ï¼Œè¿™äº›å‡½æ•°ç»å¸¸åœ¨æ¶æ„ JS ä»£ç ä¸­ä½¿ç”¨:**

**![](img/bf0df9bd8160428b19170c8b2bf7f5e3.png)**

**æ¶æ„ JavaScript ä¸­å¹¿æ³›ä½¿ç”¨çš„å‡½æ•°ï¼Œæ¥æº:[åŸºäºåŒå‘ LSTM æ¨¡å‹çš„æ¶æ„ JavaScript æ£€æµ‹](https://www.mdpi.com/2076-3417/10/10/3440)**

**![](img/714b052599bd1e39311f343281085453.png)****![](img/e69d968953389b8aef840d41bc6213f3.png)****![](img/9ea4246bbe2a85c9770d012f43998a50.png)****![](img/63d3b399faa3f53251e91593f086b361.png)**

****è®­ç»ƒ/æµ‹è¯•æ•°æ®åˆ†å‰²****

****éšæœºæ£®æ—æ¨¡å‹****

****æŒ‡æ ‡ç»“æœ****

**![](img/e6f15163511e13a7656e58ca48c05c70.png)**

**ğŸ‘‰ğŸ»å®Œæ•´çš„ä»£ç ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘çš„ GitHub è·å¾—ã€‚**

## **è¿›ä¸€æ­¥é˜…è¯»**

**[1] S. Aebersold ç­‰äººï¼Œ[åˆ©ç”¨æœºå™¨å­¦ä¹ æ£€æµ‹æ··æ·† JavaScript](https://www.researchgate.net/publication/321805699_Detecting_Obfuscated_JavaScripts_using_Machine_Learning)(2016)ï¼ŒICIMP 2016:ç¬¬åä¸€å±Šäº’è”ç½‘ç›‘æ§ä¸ä¿æŠ¤å›½é™…ä¼šè®®**

**[2] S. Ndichu ç­‰äººï¼Œ[ä½¿ç”¨ AST ç‰¹å¾å’Œæ®µè½å‘é‡æ£€æµ‹åŸºäº JavaScript çš„æ”»å‡»çš„æœºå™¨å­¦ä¹ æ–¹æ³•](https://www.sciencedirect.com/science/article/pii/S1568494619305022) (2019)ï¼Œåº”ç”¨è½¯è®¡ç®—**

**[3] A. Fass ç­‰äººï¼Œ [JAST:æ¶æ„(æ··æ·†)JavaScript çš„å®Œå…¨è¯­æ³•æ£€æµ‹](https://link.springer.com/chapter/10.1007/978-3-319-93411-2_14) (2018)ï¼Œè¿ªå§†ç“¦**

**[4] X. Song ç­‰ï¼Œã€åŸºäºåŒå‘ LSTM æ¨¡å‹çš„æ¶æ„ JavaScript æ£€æµ‹ã€‘ (2020)ï¼Œåº”ç”¨ç§‘å­¦**