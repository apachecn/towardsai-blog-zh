# ç«èŠ±æµç¬¬ 1 éƒ¨åˆ†|| Python

> åŸæ–‡ï¼š<https://pub.towardsai.net/spark-streaming-part-1-python-9658a292005?source=collection_archive---------1----------------------->

![](img/f62f31e03f1632eb4c1d1340546702cc.png)

å…‹é‡Œæ–¯æ‰˜å¤«Â·é«˜å°”åœ¨ [Unsplash](https://unsplash.com/s/photos/data-science?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

åœ¨ä½ çš„æˆ¿å­è¢«é—¯å…¥åé†’æ¥æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿéš¾é“ä½ ä¸è§‰å¾—åœ¨å¤§ç¾éš¾å·²ç»é‡åˆ›ä½ ä¹‹åå†è­¦é†’è‡ªå·±æ˜¯æ²¡æœ‰ç”¨çš„å—ï¼Ÿæˆ‘ä»¬éœ€è¦å®æ—¶äº†è§£è¿™äº›äº‹æƒ…ã€‚å¯¹å—ï¼Ÿï¼Ÿï¼Ÿ

æˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸å¥½çš„å°åº¦è¯­çŸ­è¯­

> â€œà¤…à¤¬ à¤ªà¤›à¤¤à¤¾à¤¯à¥‡ à¤¹à¥‹à¤¤ à¤•à¥à¤¯à¤¾ à¤œà¤¬ à¤šà¤¿à¥œà¤¿à¤¯à¤¾à¤ à¤šà¥à¤— à¤—à¤ˆ à¤–à¥‡à¤¤â€

è¿™æ„å‘³ç€:- **å½“é¸Ÿå„¿ç³Ÿè¹‹äº†ç”°é‡ï¼Œå®ƒä»¬åƒæ‰äº†ç§å­ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ç•™ä¸‹ï¼Œ**

**ä¸ºä»€ä¹ˆç°åœ¨è§‰å¾—éš¾è¿‡ã€‚**

è¿™ä¸ªæ•…äº‹çš„å¯“æ„æ˜¯â€œåŠæ—¶åšå¥½æ¯ä¸€ä»¶äº‹ã€‚â€

ä¸è¦ç­‰åˆ°å¤ªæ™šçš„æ—¶å€™å†è¡ŒåŠ¨ã€‚åˆ°æ—¶å€™ä½ ä¼šåæ‚”çš„ã€‚

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¨å‡ºäº†â€œç«èŠ±æµâ€æ¥å¸®åŠ©æ‚¨ã€‚

> ***è¿™ç¯‡æ–‡ç« æˆ‘ä»¬è¦è®²ä»€ä¹ˆï¼Ÿ***

*   ä»€ä¹ˆæ˜¯æ•°æ®æµï¼Ÿ
*   æµå¼æ•°æ®çš„é‡è¦æ€§
*   æ•°æ®æµåº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜
*   ä»€ä¹ˆæ˜¯ç«èŠ±æµï¼Ÿ
*   ä½¿ç”¨ Socket || Python çš„å®æ—¶æ•°æ®æµ

**æˆ‘ä»¬å‡ºå‘å§ï¼ï¼ï¼ˆğŸŒŸ)**

> **ä»€ä¹ˆæ˜¯æ•°æ®æµï¼Ÿ**

å•è¯â€œæµâ€ç”¨äºæè¿°è¿ç»­çš„ã€æ°¸ä¸ç»“æŸçš„æ•°æ®æµï¼Œæ²¡æœ‰èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œ

æ•°æ®æµæ˜¯ä¼ è¾“ç§°ä¸ºæµçš„è¿ç»­æ•°æ®æµçš„è¿‡ç¨‹ï¼Œ

æ•°æ®æµç”±ä¸€ç³»åˆ—æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„æ•°æ®ç»„æˆã€‚ä¾‹å¦‚ï¼Œæ•°æ®æµåŒ…æ‹¬ä¼ æ„Ÿå™¨æ•°æ®ã€äº¤æ˜“æ—¥å¿—ã€IOT æ•°æ®ã€ç½‘ç»œæµè§ˆå™¨æ—¥å¿—ç­‰ç­‰ã€‚

æˆ‘ä»¬å¯ä»¥å°†æ•°æ®æµè§†ä¸ºä¸€æ¡ä¼ é€å¸¦ï¼Œå®ƒæºå¸¦æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œéšåå¯ç”¨äºå®æ—¶æ£€æµ‹æ¬ºè¯ˆã€ç›‘æ§å¥åº·çŠ¶å†µã€å‘é€è­¦æŠ¥å¹¶å®æ—¶å¯è§†åŒ–æ•°æ®ï¼Œè¿™éå¸¸æœ‰å¸®åŠ©ã€‚

> **æµæ•°æ®çš„é‡è¦æ€§:**

ä»Šå¤©çš„æ•°æ®æ˜¯ç”±æ— é™é‡çš„æ¥æºç”Ÿæˆçš„ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ IOT æ•°æ®ä¼ æ„Ÿå™¨ã€ç½‘ç»œæ—¥å¿—ã€æ¸¸æˆåº”ç”¨ç¨‹åºã€å®‰å…¨æ—¥å¿—ã€æœåŠ¡å™¨ç­‰ç­‰ï¼Œå‡ ä¹ä¸å¯èƒ½æ§åˆ¶å’Œç®¡ç†æ•°æ®ã€‚

æ‰€ä»¥å¤„ç†æ•°æ®æµçš„åº”ç”¨ç¨‹åºéœ€è¦ä¸€äº›åŠŸèƒ½:å­˜å‚¨å’Œæ•°æ®å¤„ç†ï¼Œ

å­˜å‚¨å¿…é¡»èƒ½å¤Ÿå¤„ç†å¤§é‡å®æ—¶æ•°æ®

æ•°æ®å¤„ç†å¿…é¡»èƒ½å¤Ÿç›¸åº”åœ°å¤„ç†å’Œå‘é€è¦æ±‚

> **å®æ—¶æ•°æ®æµçš„çœŸå®ä¸–ç•Œç¤ºä¾‹**

![](img/5c16d53af2e050dbfb5d436a410fc0b1.png)

æ‹‰æ–¯Â·é‡‘å‹’åœ¨ [Unsplash](https://unsplash.com/s/photos/data-streaming?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

*   æ¬ºè¯ˆæ£€æµ‹
*   å®æ—¶å¤šäººæ¸¸æˆ
*   ç‰©è”ç½‘ä¼ æ„Ÿå™¨æ•°æ®
*   å®¢æˆ·æ´»åŠ¨
*   å®æ—¶æ£€æµ‹ä»‡æ¨è¨€è®º(ç¤¾äº¤åª’ä½“)
*   ç¤¾äº¤åª’ä½“æ¨é€
*   AL/ML å®æ—¶é¢„æµ‹

å¦‚æ­¤ç­‰ç­‰ï¼Œä¸èƒœæšä¸¾â€¦

> **æ•°æ®æµåº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜**

*   **å¯æ‰©å±•æ€§:-** æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ ¹æ®éœ€è¦å­˜å‚¨å’Œæ‰©å±•çš„ç³»ç»Ÿï¼Œå› ä¸ºæˆ‘ä»¬æœ‰å¤§é‡çš„æ•°æ®ã€‚
*   **å®¹é”™å’Œæ•°æ®ä¿è¯:-** å¯¹äºæ¥è‡ªä¸åŒæ¥æºã€ä½ç½®ã€æ ¼å¼å’Œä¸åŒé€Ÿåº¦çš„æ•°æ®ï¼Œä¸ºäº†å¤„ç†å’Œå­˜å‚¨æ‰€æœ‰è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå¿…é¡»å…·æœ‰å®¹é”™èƒ½åŠ›ï¼Œå¹¶ç¡®ä¿ç”¨æˆ·å‘é€çš„ä»»ä½•æ•°æ®éƒ½èƒ½è¢«æˆ‘ä»¬çš„æµç®¡é“æ¥æ”¶ï¼Œä»è€Œç¡®ä¿æ•°æ®ä¿è¯ã€‚
*   **æ’åº:-** ç”±äºæˆ‘ä»¬çš„æ•°æ®ä»¥ä¸åŒçš„é€Ÿåº¦åˆ°æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ•°æ®æœ‰åºï¼Œå¦åˆ™å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æµå¤„ç†ç®¡é“å¿…é¡»çŸ¥é“æ•°æ®äº‹åŠ¡å±æ€§ã€‚

ä¸ºäº†ç»´æŠ¤æ‰€æœ‰è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„â€œApache Spark â€,å¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨å¥—æ¥å­—å¤„ç†å®æ—¶ä¼ å…¥çš„æ•°æ®ã€‚

> **ä»€ä¹ˆæ˜¯ç«èŠ±æµ:-**

![](img/06c882769433f0b3833dd9c126d5f892.png)

[https://spark.apache.org/docs/latest/img/streaming-arch.png](https://spark.apache.org/docs/latest/img/streaming-arch.png)

Spark Streaming æ˜¯å¤„ç†é«˜åˆ—æ•°æ®çš„é«˜é€Ÿå¼•æ“ï¼Œå®ƒæ¯”è°·æ­Œçš„ MapReduce å¿« 100 å€ï¼ŒåŸå› æ˜¯å®ƒä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®å¤„ç†ï¼Œå¯ä»¥ç”Ÿæˆå°å—æ•°æ®ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šå¹¶è¡Œè®¡ç®—ã€‚

Spark Streaming ä½¿ç”¨ Spark Core çš„å¿«é€Ÿè°ƒåº¦åŠŸèƒ½æ¥æ‰§è¡Œæµåˆ†æã€‚å®ƒä»¥å°æ‰¹é‡çš„æ–¹å¼æ¥æ”¶æ•°æ®ï¼Œå¹¶å¯¹è¿™äº›å°æ‰¹é‡çš„æ•°æ®æ‰§è¡Œ RDD å˜æ¢ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ä¸ºæ‰¹é‡åˆ†æç¼–å†™çš„åŒä¸€ç»„åº”ç”¨ç¨‹åºä»£ç èƒ½å¤Ÿç”¨äºæµåˆ†æï¼Œä»è€Œæœ‰åŠ©äº lambda æ¶æ„çš„è½»æ¾å®ç°ã€‚

ç„¶è€Œï¼Œè¿™ç§ä¾¿åˆ©ä¼´éšç€ç­‰å¾…æ—¶é—´ç­‰äºå°æ‰¹é‡æŒç»­æ—¶é—´çš„ä»£ä»·ã€‚å…¶ä»–é€äº‹ä»¶å¤„ç†è€Œä¸æ˜¯å°æ‰¹é‡å¤„ç†çš„æµæ•°æ®å¼•æ“åŒ…æ‹¬ Storm å’Œ Flink çš„æµç»„ä»¶ã€‚Spark Streaming å†…ç½®äº†å¯¹ Kafkaã€Flumeã€Twitterã€ZeroMQã€Kinesis å’Œ TCP/IP å¥—æ¥å­—æ¶ˆè´¹çš„æ”¯æŒã€‚[ç»´åŸº]

Spark æµæ˜¯å¤§æ•°æ®æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚å…¶å®æ—¶åœ°ä»ä¸åŒçš„æºæ¥æ”¶æ•°æ®å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¹¶å¯¹å…¶åº”ç”¨ Al/ML æ¨¡å‹å’Œå…¶ä»–åŠŸèƒ½ï¼Œä»¥å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­æˆ–è¿›è¡Œå®æ—¶æ“ä½œã€‚

> **ä½¿ç”¨ Socket || Python çš„å®æ—¶æ•°æ®æµ**

![](img/22a1bdb7d2eed797528dca907b3ec11d.png)

ã€https://spark.apache.org/docs/latest/img/streaming-flow.png å·

**æ­¥éª¤ 1:-åˆ›å»º Spark ä¼šè¯:**

Spark session æ˜¯ Spark åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æˆ‘ä»¬çš„ spark åº”ç”¨ç¨‹åºåç§°ï¼Œè¿™ä¸ªåç§°åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸º spark æ ¹æ®åº”ç”¨ç¨‹åºåç§°æ¥è¯†åˆ«è¿è¡Œçš„é›†ç¾¤ã€‚åˆ›å»º spark ä¼šè¯

```
# creating spark sessionspark = SparkSession.builder.appName(â€œSocketExampleâ€).master(â€˜local[*]â€™).getOrCreate()
```

**æ­¥éª¤ 2:-åˆ›å»ºä¸€ä¸ªä»å¥—æ¥å­—è¯»å–æ•°æ®çš„å‡½æ•°:-**

*   éœ€è¦åˆ›å»º stream_dfï¼Œå®ƒåŒ…å«æ¥è‡ªæŸä¸ªç«¯å£å’Œä¸»æœºåçš„å¥—æ¥å­—çš„æ•°æ®

```
# loading/reading data from socketstream_df = spark.readStream.format(â€˜socketâ€™).option(â€œhostâ€,host).option(â€œportâ€,port).load()
```

**æ­¥éª¤ 3:-æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºæµï¼Œå¹¶æ‰“å°æ¨¡å¼**

```
# check if still streamingprint(stream_df.isStreaming)
stream_df.printSchema()
```

**æ­¥éª¤ 4:-å°†æ¥æ”¶åˆ°çš„æ•°æ®å†™å…¥æ§åˆ¶å°(æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿å­˜è¯¥æ•°æ®ï¼Œæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­çœ‹åˆ°)**

```
# write stream in consolewrite_query = stream_df.writeStream.format(â€˜consoleâ€™).start()
```

**æ­¥éª¤ 5:ç­‰å¾…æ’åº§å…³é—­**

```
write_query.awaitTermination()
```

å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®Œæ•´çš„ä»£ç 

> **å®Œæ•´ä»£ç :-**

ä¹‹åï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œåœ¨ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨â€œnetcat -lk 1100â€å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šè¿è¡Œâ€œsocket_streaming.pyâ€å’Œ WALLAï¼ï¼

![](img/46754838c9fb14a4894d240c7113a05a.png)

å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘é€æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰¹é‡å®æ—¶è·å–æ•°æ®ã€‚

å› æ­¤ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨è§¦å‘å™¨æ¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä»¥åŠå¦‚ä½•å®æ—¶æ‰§è¡Œæ•°æ®è½¬æ¢ï¼Œç­‰ç­‰ï¼Œæ•¬è¯·å…³æ³¨â€¦

å°±è¿™æ ·å§ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« å†è§ã€‚

æˆ‘å·²ç»ä¸ºé‚£äº›ä¸å±äºæˆ‘çš„å›¾ç‰‡æä¾›äº†å›¾ç‰‡é“¾æ¥ã€‚

**æˆ‘ä»¬æ¥è¿çº¿ä¸€ä¸‹**[**Linkedin**](https://www.linkedin.com/in/iamhimanshu0/)**[**Twitter**](https://twitter.com/iam_himanshu0)**[**insta gram**](https://instagram.com/iamhimanshu0/)**[**Github**](https://github.com/iamhimanshu0)**ï¼Œä»¥åŠ** [**è„¸ä¹¦**](https://www.facebook.com/iamhimanshu0) **ã€‚********

******æ„Ÿè°¢é˜…è¯»ï¼******