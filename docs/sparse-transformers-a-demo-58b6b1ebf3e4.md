# ç¨€ç–å˜å½¢é‡‘åˆš|æ¼”ç¤º

> åŸæ–‡ï¼š<https://pub.towardsai.net/sparse-transformers-a-demo-58b6b1ebf3e4?source=collection_archive---------2----------------------->

![](img/7d521c07e03a105f892d7d5b09011874.png)

åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šç”± [Rishabh Pandoh](https://unsplash.com/@_rishabhpandoh_?utm_source=medium&utm_medium=referral) æ‹æ‘„çš„ç…§ç‰‡

## ç¨€ç–æƒ…å†µä¸‹ BERT èƒ½èµ°å¤šå¿«ï¼Ÿ

# è¿™é‡Œæœ‰ä¸ªå°ç§˜å¯†:

å¦‚æœä½ æƒ³åˆ†æ 19 ä¸ªç¨€ç– BERT æ¨¡å‹æ‰§è¡Œæ¨ç†çš„é€Ÿåº¦ï¼Œä½ åªéœ€è¦ä¸€ä¸ª YAML æ–‡ä»¶å’Œ 16GB çš„å†…å­˜å°±å¯ä»¥çŸ¥é“ã€‚å‰§é€è­¦å‘Š:

â€¦å®ƒä»¬åœ¨ CPU ä¸Šè¿è¡Œã€‚

â€¦è€Œä¸”å®ƒä»¬è¶…çº§å¿«ï¼

![](img/03d901e18941188a202054d85e9fe53e.png)

æ¥è‡ª Neural Magic çš„[**DeepSparse**](https://github.com/neuralmagic/deepsparse)**repo çš„æœ€æ–°åŠŸèƒ½å°±æ˜¯ deep sparse æœåŠ¡å™¨ï¼æœ¬æ–‡çš„ç›®çš„ä¸ä»…æ˜¯å±•ç¤ºä¸ºå¤šè¾¾ 19 ä¸ªç¨€ç– BERT æ¨¡å‹æä¾›æœåŠ¡çš„æ— ç¼æ€§ï¼Œè¿˜å±•ç¤ºç¨€ç–æ€§å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚ä½œä¸ºä¸€ç‚¹èƒŒæ™¯ï¼Œç¨€ç–åŒ–æ˜¯é‡‡ç”¨ç»è¿‡è®­ç»ƒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹å¹¶ä»è¿‡åº¦å‚æ•°åŒ–çš„ç½‘ç»œä¸­ç§»é™¤å†—ä½™ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œä»è€Œäº§ç”Ÿæ›´å¿«ã€æ›´å°çš„æ¨¡å‹ã€‚å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å„ç§ BERT æ¨¡å‹å¹¶åŠ è½½å®ƒä»¬è¿›è¡Œæ¨ç†ï¼Œä»¥æ˜¾ç¤ºç›¸å¯¹äºæ¨¡å‹ç¨€ç–åŒ–çš„å‡†ç¡®æ€§å’Œé€Ÿåº¦ä¹‹é—´çš„æƒè¡¡ã€‚**

**DeepSparse æœåŠ¡å™¨å»ºç«‹åœ¨æˆ‘ä»¬çš„ DeepSparse å¼•æ“å’Œæµè¡Œçš„ FastAPI web æ¡†æ¶ä¹‹ä¸Šï¼Œå…è®¸ä»»ä½•äººä»¥ GPU çº§çš„é€Ÿåº¦åœ¨ç”Ÿäº§ä¸­éƒ¨ç½²ç¨€ç–æ¨¡å‹ï¼Œä½†åœ¨ CPU ä¸Šï¼å€ŸåŠ© DeepSparse å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥é›†æˆåˆ°æµè¡Œçš„æ·±åº¦å­¦ä¹ åº“(ä¾‹å¦‚ï¼ŒHugging Faceã€Ultralytics)ä¸­ï¼Œä»è€Œå…è®¸æ‚¨ä½¿ç”¨ ONNX éƒ¨ç½²ç¨€ç–æ¨¡å‹ã€‚**

**å¦‚å‰æ‰€è¿°ï¼Œåœ¨ç”Ÿäº§ä¸­è¿è¡Œæ¨¡å‹æ‰€éœ€çš„æ‰€æœ‰é…ç½®åªéœ€è¦ä¸€ä¸ª YAML æ–‡ä»¶å’Œå°‘é‡å†…å­˜(ç”±äºç¨€ç–æ€§)ã€‚ä¸ºäº†å¿«é€Ÿå¼€å§‹ä¸ºå››ä¸ªç»è¿‡é—®ç­”ä»»åŠ¡è®­ç»ƒçš„ BERT æ¨¡å‹æä¾›æœåŠ¡ï¼Œä¸‹é¢æ˜¯é…ç½® YAML æ–‡ä»¶çš„æ ·å­:**

**![](img/ad7d829961734186a9e7718203feda60.png)**

**config.yaml**

**å¦‚æœæ‚¨æƒ³å˜å¤§å¹¶åŠ è½½æ‰€æœ‰ 19 ä¸ªç¥ç»é­”æœ¯ç¨€ç– BERT æ¨¡å‹:è¿™æ˜¯é…ç½®æ–‡ä»¶çœ‹èµ·æ¥åƒä»€ä¹ˆğŸ‘€ï¼š**

**![](img/32826a3cbf9bc401fc21b2ac7e5a1024.png)**

**ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨ Streamlit ä¸Šæ„å»ºäº†ä¸€ä¸ªæ¼”ç¤ºï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨ NLP ä¸­æ¼”ç¤ºé—®ç­”ä»»åŠ¡çš„æœåŠ¡å™¨å’Œæ¨¡å‹ã€‚ä¸ºäº†åŒæ—¶æµ‹è¯• 19 ä¸ªæ¨¡å‹ï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨è°·æ­Œäº‘å¹³å°çš„è™šæ‹Ÿæœºä¸Šè¿›è¡Œæµ‹è¯•ã€‚**

**ä¸ºäº†ç»™æˆ‘åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„è®¡ç®—æä¾›ä¸€äº›åŸºç¡€ï¼Œä¸‹é¢æ˜¯ä¸€äº›ç»†èŠ‚:**

***è¯·è®°ä½ï¼Œåœ¨æœ¬æ–‡æè¿°çš„ç›¸åŒè®¡ç®—é™åˆ¶ä¸‹ï¼Œè£¸æœºå®é™…ä¸Šä¼šæ‰§è¡Œå¾—æ›´å¿«ã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›æ¨¡å‹å·²ç»éå¸¸å¿«äº†ï¼Œæˆ‘å¾ˆä¹æ„é€šè¿‡è™šæ‹ŸåŒ–æ¥å±•ç¤ºå®ƒä»¬çš„é€Ÿåº¦ã€‚***

**æˆ‘ä»¬ä¸ä»…å¼ºçƒˆå»ºè®®æ‚¨åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šè¿è¡Œç›¸åŒçš„æµ‹è¯•æ¥è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œè€Œä¸”è¿™æ ·æ‚¨å°±æœ‰äº†å°†æ‰€æœ‰ 19 ä¸ª BERTs åŠ è½½åˆ°å†…å­˜ä¸­æ‰€éœ€çš„ RAMï¼Œå¦åˆ™æ‚¨ä¼šå¾—åˆ°è¿™ä¸ªğŸ‘‡ï¼š**

**ä¼¯çˆ¶**

**å¦‚æœæ‚¨å–œæ¬¢åœ¨æœ¬åœ°æœºå™¨ä¸Šå¿«é€Ÿå¯åŠ¨ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå†…å­˜ä¸è¶³çš„é—®é¢˜ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥å°è¯•åªå°†ä¸€äº›æ¨¡å‹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä¸‹é¢çš„ä»£ç å°†å‘ä½ å±•ç¤ºå¦‚ä½•ç”¨ 4 ä¸ªæ¨¡å‹åšåˆ°è¿™ä¸€ç‚¹(å°½ç®¡å¤§å¤šæ•°ç¨€ç–æ¨¡å‹éƒ½æ˜¯è¶…è½»çš„ï¼Œä½ å¯ä»¥éšæ„æ·»åŠ æ›´å¤š)ã€‚**

# **å¼€å§‹ä½¿ç”¨ SparseServerã€‚ç”¨æˆ·ç•Œé¢**

**æˆ‘ä»¬å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ†æˆå•ç‹¬çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç›®å½•ã€‚æœåŠ¡å™¨ç›®å½•åŒ…å«ç”¨äºåŠ è½½æ¨¡å‹çš„ YAML æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯åŒ…å« Streamlit åº”ç”¨ç¨‹åºçš„é€»è¾‘:**

```
~sparseserver-ui/
    |__client/
       |__app.py
       |__pipelineclient.py
       |__samples.py
       |__settings.py     
    |__server/
       |__big-config.yaml
       |__config.yaml
    |__requirements.txt
    |__README.md
```

## **1.å…‹éš†æ·±åº¦ç¨€ç–å­˜å‚¨åº“:**

```
>>> git clone [https://github.com/neuralmagic/deepsparse.git](https://github.com/neuralmagic/deepsparse.git)
```

## **2.å®‰è£… DeepSparse æœåŠ¡å™¨å¹¶ç®€åŒ–:**

```
>>> cd deepsparse/examples/sparseserver-ui>>> pip install -r requirements.txt
```

**åœ¨æˆ‘ä»¬è¿è¡ŒæœåŠ¡å™¨ä¹‹å‰ï¼Œæ‚¨å¯ä»¥åœ¨æˆ‘ä»¬çš„å¯åŠ¨ CLI å‘½ä»¤ä¸­é…ç½®`host`å’Œ`port`å‚æ•°ã€‚å¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œå®ƒå°†åœ¨`localhost`å’Œç«¯å£`5543`ä¸Šè¿è¡ŒæœåŠ¡å™¨ã€‚æœ‰å…³ CLI å‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è¿è¡Œ:**

```
>>> deepsparse.server --help
```

## **3.è¿è¡Œ DeepSparse æœåŠ¡å™¨:**

**å¥½å§ï¼æ˜¯æ—¶å€™ä¸º`config.yaml`ä¸­å®šä¹‰çš„æ‰€æœ‰æ¨¡å‹æä¾›æœåŠ¡äº†ã€‚è¿™ä¸ª YAML æ–‡ä»¶å°†ä» Neural Magic çš„ [SparseZoo](https://sparsezoo.neuralmagic.com/?domain=nlp&sub_domain=question_answering&page=1) ğŸ¦¾.ä¸‹è½½å››ä¸ªæ¨¡å‹**

```
>>> deepsparse.server --config_file server/config.yaml
```

**ä¸‹è½½å®Œæ¨¡å‹å¹¶ä¸”æ‚¨çš„æœåŠ¡å™¨å¯åŠ¨å¹¶è¿è¡Œåï¼Œæ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯æ¥æµ‹è¯•å®¢æˆ·ç«¯ã€‚**

**âš ï¸ *å¦‚æœæ‚¨åœ¨ç¬¬ä¸€æ¬¡è¿è¡ŒæœåŠ¡å™¨æ—¶æ›´æ”¹äº†* `*host*` *å’Œ* `*port*` *é…ç½®ï¼Œè¯·åŒæ—¶è°ƒæ•´* `*pipelineclient.py*` *æ¨¡å—ä¸­çš„è¿™äº›å˜é‡ã€‚***

## **4.è¿è¡Œ Streamlit å®¢æˆ·ç«¯:**

```
>>> streamlit run client/app.py --browser.serverAddress="localhost"
```

**å°±æ˜¯è¿™æ ·ï¼ç‚¹å‡»ç»ˆç«¯ä¸­çš„ URLï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹ä¸æ¼”ç¤ºäº¤äº’äº†ã€‚æ‚¨å¯ä»¥ä»åˆ—è¡¨ä¸­é€‰æ‹©ç¤ºä¾‹ï¼Œä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„ä¸Šä¸‹æ–‡å’Œé—®é¢˜ã€‚**

**![](img/afe7266e025f48826d23789951d2afcb.png)**

**åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å°†æ‰©å±• NLP ä»»åŠ¡çš„æ•°é‡ï¼Œä¸ä»…ä»…æ˜¯å›ç­”é—®é¢˜ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ç¨€ç–æ€§æ–¹é¢è·å¾—æ›´å¤§çš„æ€§èƒ½ã€‚**

**å®Œæ•´ä»£ç :æŸ¥çœ‹ [SparseServerã€‚ç”¨æˆ·ç•Œé¢](https://github.com/neuralmagic/deepsparse/tree/main/examples/sparseserver-ui) â€¦**

**â€¦åˆ«å¿˜äº†ç»™æ·±åº¦ç¨€ç–å›è´­ä¸€ä¸ª GitHubâ­ï¼**

*   **ç‘å¥‡ç§‘æ–¯å¡”| [ç¥ç»é­”æ³•](https://neuralmagic.com/) ğŸ§™**